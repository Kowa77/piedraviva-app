"use strict";(self.webpackChunkpiedraviva_app=self.webpackChunkpiedraviva_app||[]).push([[421],{5421:(K,M,a)=>{a.r(M),a.d(M,{ProductDetailComponent:()=>L});var F=a(467),v=a(2200),k=a(8132),P=a(7673),_=a(8141),O=a(5558),E=a(9437),I=a(1413),S=a(6129);class j extends I.B{constructor(r=1/0,e=1/0,n=S.U){super(),this._bufferSize=r,this._windowTime=e,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,e)}next(r){const{isStopped:e,_buffer:n,_infiniteTimeWindow:o,_timestampProvider:d,_windowTime:c}=this;e||(n.push(r),!o&&n.push(d.now()+c)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(r),{_infiniteTimeWindow:n,_buffer:o}=this,d=o.slice();for(let c=0;c<d.length&&!r.closed;c+=n?1:2)r.next(d[c]);return this._checkFinalizedStatuses(r),e}_trimBuffer(){const{_bufferSize:r,_timestampProvider:e,_buffer:n,_infiniteTimeWindow:o}=this,d=(o?1:2)*r;if(r<1/0&&d<n.length&&n.splice(0,n.length-d),!o){const c=e.now();let s=0;for(let l=1;l<n.length&&n[l]<=c;l+=2)s=l;s&&n.splice(0,s+1)}}}var T=a(8750),w=a(7707),D=a(9974);function x(i,r,...e){if(!0===r)return void i();if(!1===r)return;const n=new w.Ms({next:()=>{n.unsubscribe(),i()}});return(0,T.Tg)(r(...e)).subscribe(n)}var $=a(4341),t=a(3664),u=a(2615),U=a(1266),A=a(6241),B=a(6868),G=a(4796);function N(i,r){if(1&i&&(t.j41(0,"span",19),t.EFF(1),t.k0s()),2&i){const e=r.$implicit;t.R7$(),t.JRh(e)}}function X(i,r){if(1&i&&(t.j41(0,"div",12),t.Z7z(1,N,2,1,"span",19,t.Vm6),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.Dyx(e.sabores)}}function V(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",6)(1,"div",7),t.nrm(2,"img",8),t.k0s(),t.j41(3,"div",9)(4,"h2",10),t.EFF(5),t.k0s(),t.j41(6,"p",11),t.EFF(7),t.k0s(),t.nVh(8,X,3,0,"div",12),t.j41(9,"div",13)(10,"span",14),t.EFF(11),t.nI1(12,"currency"),t.k0s(),t.j41(13,"div",15)(14,"button",16),t.bIt("click",function(){u.eBV(e);const o=t.XpG(2);return u.Njj(o.decrementQuantity())}),t.EFF(15,"-"),t.k0s(),t.j41(16,"input",17),t.bIt("input",function(o){u.eBV(e);const d=t.XpG(2);return u.Njj(d.onQuantityInputChange(o))}),t.k0s(),t.j41(17,"button",16),t.bIt("click",function(){u.eBV(e);const o=t.XpG(2);return u.Njj(o.incrementQuantity())}),t.EFF(18,"+"),t.k0s(),t.j41(19,"button",18),t.bIt("click",function(){u.eBV(e);const o=t.XpG(),d=t.XpG();return u.Njj(d.addToCart(o))}),t.EFF(20,"Agregar al Carrito"),t.k0s()()()()()}if(2&i){const e=t.XpG(),n=t.XpG();t.R7$(2),t.Y8G("alt",t.VkB("Imagen de ",e.nombre))("src",e.imagenUrl||"https://placehold.co/600x400/FF5733/FFFFFF?text="+n.encodeURIComponent(e.nombre||"Producto"),t.B4B),t.R7$(3),t.JRh(e.nombre),t.R7$(2),t.JRh(e.descripcion),t.R7$(),t.vxM(n.isPizza(e)&&e.sabores&&e.sabores.length?8:-1),t.R7$(3),t.JRh(t.ii3(12,8,e.precio,"UYU","$","1.2-2")),t.R7$(5),t.Y8G("value",n.selectedQuantity)}}function W(i,r){1&i&&(t.j41(0,"div",5)(1,"p"),t.EFF(2,"Producto no encontrado o error desconocido en el flujo de datos."),t.k0s()())}function Y(i,r){if(1&i&&t.nVh(0,V,21,13,"div",6)(1,W,3,0,"div",5),2&i){const e=r,n=t.XpG();t.vxM(e&&!n.loading?0:e||n.loading||n.errorMessage?-1:1)}}function J(i,r){1&i&&(t.j41(0,"div",4)(1,"p"),t.EFF(2,"Cargando detalles del producto..."),t.k0s()())}function H(i,r){if(1&i&&(t.j41(0,"div",5)(1,"p"),t.EFF(2),t.k0s()()),2&i){const e=t.XpG();t.R7$(2),t.JRh(e.errorMessage)}}let L=(()=>{class i{route;productService;cartService;authService;product$;loading=!0;errorMessage=null;selectedQuantity=0;userId=null;constructor(e,n,o,d){this.route=e,this.productService=n,this.cartService=o,this.authService=d,this.product$=(0,P.of)(void 0)}ngOnInit(){console.log("NGONINIT: Inicializando ProductDetailComponent..."),this.product$=this.authService.user$.pipe((0,_.M)(e=>{this.userId=e?e.uid:null,console.log("TAP (AuthService.user$): User ID despu\xe9s del cambio de estado de autenticaci\xf3n:",this.userId)}),(0,O.n)(()=>(console.log("SWITCHMAP (paramMap): Preparando para obtener par\xe1metros de ruta."),this.route.paramMap)),(0,O.n)(e=>{const n=e.get("id");return this.loading=!0,this.errorMessage=null,console.log("SWITCHMAP (params): ID de producto detectado:",n),console.log("SWITCHMAP (params): loading establecido a TRUE. errorMessage limpiado."),n?this.productService.getProductById(n).pipe((0,_.M)(o=>{console.log("TAP (getProductById SUCCESS): Producto recibido del servicio:",o),this.loading=!1,console.log("TAP (getProductById SUCCESS): loading establecido a FALSE."),o?(this.selectedQuantity=1,console.log("TAP (getProductById SUCCESS): Cantidad seleccionada inicializada a 1.")):(this.errorMessage="Producto no encontrado. El ID podr\xeda ser inv\xe1lido o el producto fue eliminado.",console.warn("TAP (getProductById SUCCESS): Producto no encontrado para ID:",n,"Estableciendo errorMessage."))}),(0,E.W)(o=>(console.error("CATCHERROR (getProductById ERROR): Error al cargar los detalles del producto:",o),this.loading=!1,this.errorMessage="No se pudo cargar la informaci\xf3n del producto. Error de red o servidor.",console.log("CATCHERROR (getProductById ERROR): loading establecido a FALSE. Estableciendo errorMessage."),(0,P.of)(void 0)))):(console.log("ELSE (paramMap): ID de producto no proporcionado. Finalizando carga."),this.loading=!1,this.errorMessage="ID de producto no proporcionado en la URL.",(0,P.of)(void 0))}),function Q(i,r,e){let n,o=!1;return i&&"object"==typeof i?({bufferSize:n=1/0,windowTime:r=1/0,refCount:o=!1,scheduler:e}=i):n=i??1/0,function z(i={}){const{connector:r=()=>new I.B,resetOnError:e=!0,resetOnComplete:n=!0,resetOnRefCountZero:o=!0}=i;return d=>{let c,s,l,m=0,g=!1,f=!1;const h=()=>{s?.unsubscribe(),s=void 0},y=()=>{h(),c=l=void 0,g=f=!1},Z=()=>{const p=c;y(),p?.unsubscribe()};return(0,D.N)((p,R)=>{m++,!f&&!g&&h();const C=l=l??r();R.add(()=>{m--,0===m&&!f&&!g&&(s=x(Z,o))}),C.subscribe(R),!c&&m>0&&(c=new w.Ms({next:b=>C.next(b),error:b=>{f=!0,h(),s=x(y,e,b),C.error(b)},complete:()=>{g=!0,h(),s=x(y,n),C.complete()}}),(0,T.Tg)(p).subscribe(c))})(d)}}({connector:()=>new j(n,r,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}(1))}ngOnDestroy(){console.log("NGONDESTROY: Destruyendo ProductDetailComponent.")}incrementQuantity(){this.selectedQuantity++,console.log("incrementQuantity: Cantidad actual:",this.selectedQuantity)}decrementQuantity(){this.selectedQuantity>1&&this.selectedQuantity--,console.log("decrementQuantity: Cantidad actual:",this.selectedQuantity)}onQuantityInputChange(e){const n=e.target,o=parseInt(n.value,10);console.log("onQuantityInputChange: Nueva cantidad ingresada:",o),!isNaN(o)&&o>=0?this.selectedQuantity=o:(this.selectedQuantity=1,n.value="1",console.warn("onQuantityInputChange: Cantidad inv\xe1lida, restableciendo a 1."))}addToCart(e){var n=this;return(0,F.A)(function*(){if(console.log("addToCart: Intentando a\xf1adir al carrito el producto:",e),n.userId)if(n.selectedQuantity<=0)console.warn("addToCart: Por favor, selecciona una cantidad mayor que 0 para a\xf1adir al carrito.");else try{yield n.cartService.addItemToCart(n.userId,e,n.selectedQuantity),console.log(`addToCart: "${e.nombre}" x${n.selectedQuantity} a\xf1adido(s) al carrito.`),n.selectedQuantity=1,console.log("addToCart: Cantidad seleccionada reiniciada a 1.")}catch(o){console.error("addToCart: Error al a\xf1adir al carrito:",o),n.errorMessage="Ocurri\xf3 un error al a\xf1adir al carrito. Por favor, int\xe9ntalo de nuevo."}else console.warn("addToCart: Debes iniciar sesi\xf3n para a\xf1adir productos al carrito.")})()}isPizza(e){return"pizza"===e.tipo||void 0!==e.sabores}encodeURIComponent(e){return encodeURIComponent(e)}static \u0275fac=function(n){return new(n||i)(t.rXU(U.nX),t.rXU(A.b),t.rXU(B.m),t.rXU(G.u))};static \u0275cmp=t.VBU({type:i,selectors:[["app-product-detail"]],decls:9,vars:4,consts:[[1,"detail-main-container"],[1,"detail-content-wrapper"],[1,"back-button-container"],["routerLink","/",1,"back-button"],[1,"loading-message-detail"],[1,"not-found-message"],[1,"product-detail-card"],[1,"product-detail-image-container"],[1,"product-detail-image",3,"src","alt"],[1,"product-detail-info"],[1,"product-detail-name"],[1,"product-detail-description"],[1,"product-detail-flavors"],[1,"product-detail-price-section"],[1,"product-detail-price"],[1,"add-to-cart-controls"],[1,"quantity-button",3,"click"],["type","number","min","1",1,"quantity-input",3,"input","value"],[1,"add-button",3,"click"],[1,"product-flavor-tag-detail"]],template:function(n,o){if(1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),t.EFF(4,"\u2190 Volver al Men\xfa"),t.k0s()(),t.nVh(5,Y,2,1),t.nI1(6,"async"),t.nVh(7,J,3,0,"div",4)(8,H,3,1,"div",5),t.k0s()()),2&n){let d;t.R7$(5),t.vxM((d=t.bMT(6,2,o.product$))?5:-1,d),t.R7$(2),t.vxM(o.loading?7:o.errorMessage?8:-1)}},dependencies:[v.MD,k.Wk,$.YN,v.Jj,v.oe],styles:[".detail-main-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a202c;color:#e2e8f0;padding:2rem;font-family:sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;flex-direction:column;align-items:center}.detail-content-wrapper[_ngcontent-%COMP%]{max-width:960px;width:100%;margin:0 auto;background-color:#2d3748;border-radius:.5rem;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;overflow:hidden;padding:2rem;position:relative}.back-button-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}.back-button[_ngcontent-%COMP%]{display:inline-block;background-color:#4a5568;color:#e2e8f0;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;transition:background-color .3s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#64748b}.product-detail-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}@media (min-width: 768px){.product-detail-card[_ngcontent-%COMP%]{flex-direction:row;align-items:flex-start}}.product-detail-image-container[_ngcontent-%COMP%]{flex-shrink:0;width:100%;max-width:400px;border-radius:.5rem;overflow:hidden;box-shadow:0 10px 20px #0000004d}.product-detail-image[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.product-detail-info[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.product-detail-name[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;color:#f6e05e;margin-bottom:1rem}.product-detail-description[_ngcontent-%COMP%]{font-size:1.125rem;color:#a0aec0;line-height:1.6;margin-bottom:1.5rem}.product-detail-flavors[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem;margin-bottom:2rem}.product-flavor-tag-detail[_ngcontent-%COMP%]{background-color:#e53e3e;color:#fff;font-size:.875rem;font-weight:600;padding:.5rem 1rem;border-radius:9999px;box-shadow:0 2px 4px #0003}.product-detail-price-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-top:1.5rem;border-top:1px solid #4a5568;margin-top:auto}.product-detail-price[_ngcontent-%COMP%]{font-size:3rem;font-weight:800;color:#f6e05e}.add-to-cart-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.quantity-button[_ngcontent-%COMP%]{background-color:#4a5568;color:#fff;border:none;border-radius:.25rem;width:35px;height:35px;font-size:1.2rem;font-weight:700;cursor:pointer;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center}.quantity-button[_ngcontent-%COMP%]:hover{background-color:#64748b}.quantity-input[_ngcontent-%COMP%]{width:60px;padding:.5rem;border:1px solid #4a5568;border-radius:.375rem;background-color:#2d3748;color:#e2e8f0;font-size:1rem;text-align:center;-moz-appearance:textfield}.quantity-input[_ngcontent-%COMP%]::-webkit-outer-spin-button, .quantity-input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.add-button[_ngcontent-%COMP%]{background-color:#f6e05e;color:#1a202c;padding:.6rem 1.2rem;border:none;border-radius:.5rem;font-size:.9rem;font-weight:700;cursor:pointer;transition:background-color .3s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a}.add-button[_ngcontent-%COMP%]:hover{background-color:#ecc94b;transform:translateY(-1px)}.add-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.loading-message-detail[_ngcontent-%COMP%], .not-found-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:300px;background-color:#2d3748;color:#a0aec0;font-size:1.25rem;border-radius:.5rem}@media (max-width: 768px){.detail-content-wrapper[_ngcontent-%COMP%]{padding:1rem}.product-detail-name[_ngcontent-%COMP%]{font-size:2rem}.product-detail-price[_ngcontent-%COMP%]{font-size:2.2rem}.product-detail-image-container[_ngcontent-%COMP%]{max-width:100%}.add-to-cart-controls[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center;width:100%}.quantity-button[_ngcontent-%COMP%], .quantity-input[_ngcontent-%COMP%], .add-button[_ngcontent-%COMP%]{flex-grow:1;max-width:unset}.add-button[_ngcontent-%COMP%]{margin-top:.5rem}}@media (max-width: 480px){.product-detail-name[_ngcontent-%COMP%], .product-detail-price[_ngcontent-%COMP%]{font-size:1.8rem}.product-detail-description[_ngcontent-%COMP%]{font-size:1rem}.product-flavor-tag-detail[_ngcontent-%COMP%]{font-size:.75rem;padding:.4rem .8rem}}"]})}return i})()}}]);
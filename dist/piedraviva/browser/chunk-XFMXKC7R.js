import{$ as On,Hb as ea,Ib as ta,Jb as Xi,Oa as Ie,S as rt,V as Rn,W as Pn,X as he,Y as Nn,_ as Xo,a as xe,b as Ot,c as Fe,ca as st,d as f,g as ne,ja as Dn,ka as Ue,l as Jo,m as Qo,o as Yi,p as Ji,q as Qi,s as kn,sa as Zo}from"./chunk-G5SB7B44.js";var na=()=>{};var er={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var _=function(n,e){if(!n)throw We(e)},We=function(n){return new Error("Firebase Database ("+er.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var sa=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Hu=function(n){let e=[],t=0,i=0;for(;t<n.length;){let r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{let s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},ct={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,d=s>>2,h=(s&3)<<4|a>>4,u=(a&15)<<2|l>>6,p=l&63;c||(p=64,o||(u=64)),i.push(t[d],t[h],t[u],t[p])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sa(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Hu(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;let l=r<n.length?t[n.charAt(r)]:64;++r;let h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||h==null)throw new tr;let u=s<<2|a>>4;if(i.push(u),l!==64){let p=a<<4&240|l>>2;if(i.push(p),h!==64){let m=l<<6&192|h;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},tr=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ir=function(n){let e=sa(n);return ct.encodeByteArray(e,!0)},Lt=function(n){return ir(n).replace(/\./g,"")},ot=function(n){try{return ct.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function oa(n){return aa(void 0,n)}function aa(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!Bu(t)||(n[t]=aa(n[t],e[t]));return n}function Bu(n){return n!=="__proto__"}function ca(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var $u=()=>ca().__FIREBASE_DEFAULTS__,ju=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zu=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&ot(n[1]);return e&&JSON.parse(e)},rr=()=>{try{return na()||$u()||ju()||zu()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},sr=n=>{var e,t;return(t=(e=rr())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},la=n=>{let e=sr(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},or=()=>{var n;return(n=rr())===null||n===void 0?void 0:n.config},ar=n=>{var e;return(e=rr())===null||e===void 0?void 0:e[`_${n}`]};var j=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function Ee(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Mn(n){return f(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function ua(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Lt(JSON.stringify(t)),Lt(JSON.stringify(o)),""].join(".")}var Dt={};function qu(){let n={prod:[],emulator:[]};for(let e of Object.keys(Dt))Dt[e]?n.emulator.push(e):n.prod.push(e);return n}function Gu(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var ia=!1;function xn(n,e){if(typeof window>"u"||typeof document>"u"||!Ee(window.location.host)||Dt[n]===e||Dt[n]||ia)return;Dt[n]=e;function t(u){return`__firebase__banner__${u}`}let i="__firebase__banner",s=qu().prod.length>0;function o(){let u=document.getElementById(i);u&&u.remove()}function a(u){u.style.display="flex",u.style.background="#7faaf0",u.style.position="fixed",u.style.bottom="5px",u.style.left="5px",u.style.padding=".5em",u.style.borderRadius="5px",u.style.alignItems="center"}function c(u,p){u.setAttribute("width","24"),u.setAttribute("id",p),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px"}function l(){let u=document.createElement("span");return u.style.cursor="pointer",u.style.marginLeft="16px",u.style.fontSize="24px",u.innerHTML=" &times;",u.onclick=()=>{ia=!0,o()},u}function d(u,p){u.setAttribute("id",p),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline"}function h(){let u=Gu(i),p=t("text"),m=document.getElementById(p)||document.createElement("span"),w=t("learnmore"),A=document.getElementById(w)||document.createElement("a"),B=t("preprendIcon"),$=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(u.created){let K=u.element;a(K),d(A,w);let it=l();c($,B),K.append($,m,A,it),document.body.appendChild(K)}s?(m.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function x(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Mt(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function da(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ha(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Fn(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fa(){let n=x();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ie(){return er.NODE_CLIENT===!0||er.NODE_ADMIN===!0}function Un(){try{return typeof indexedDB=="object"}catch{return!1}}function pa(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Ku="FirebaseError",Y=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=Ku,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,J.prototype.create)}},J=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?Yu(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new Y(r,a,i)}};function Yu(n,e){return n.replace(Ju,(t,i)=>{let r=e[i];return r!=null?String(r):`<${i}?>`})}var Ju=/\{\$([^}]+)}/g;function at(n){return JSON.parse(n)}function P(n){return JSON.stringify(n)}var _a=function(n){let e={},t={},i={},r="";try{let s=n.split(".");e=at(ot(s[0])||""),t=at(ot(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}};var ma=function(n){let e=_a(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},ga=function(n){let e=_a(n).claims;return typeof e=="object"&&e.admin===!0};function Q(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ve(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function xt(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ft(n,e,t){let i={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function re(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let r of t){if(!i.includes(r))return!1;let s=n[r],o=e[r];if(ra(s)&&ra(o)){if(!re(s,o))return!1}else if(s!==o)return!1}for(let r of i)if(!t.includes(r))return!1;return!0}function ra(n){return n!==null&&typeof n=="object"}function He(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function lt(n){let e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){let[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function ut(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}var Ln=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);let i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){let u=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(u<<1|u>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,d;for(let h=0;h<80;h++){h<40?h<20?(l=a^s&(o^a),d=1518500249):(l=s^o^a,d=1859775393):h<60?(l=s&o|a&(s|o),d=2400959708):(l=s^o^a,d=3395469782);let u=(r<<5|r>>>27)+l+c+d+i[h]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=u}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let i=t-this.blockSize,r=0,s=this.buf_,o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}};function va(n,e){let t=new nr(n,e);return t.subscribe.bind(t)}var nr=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");Qu(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=Zi),r.error===void 0&&(r.error=Zi),r.complete===void 0&&(r.complete=Zi);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Qu(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Zi(){}function Ut(n,e){return`${n} failed: ${e} argument `}var ya=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){let s=r-55296;i++,_(i<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Wt=function(n){let e=0;for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};var ev=4*60*60*1e3;function O(n){return n&&n._delegate?n._delegate:n}var F=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Be="[DEFAULT]";var Wn=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new j;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),r=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zu(e))try{this.getOrInitializeService({instanceIdentifier:Be})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=Be){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return f(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Be){return this.instances.has(e)}getOptions(e=Be){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;let r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Xu(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Be){return this.component?this.component.multipleInstances?e:Be:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Xu(n){return n===Be?void 0:n}function Zu(n){return n.instantiationMode==="EAGER"}var Vt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Wn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var ed=[],b=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(b||{}),td={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},nd=b.INFO,id={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},rd=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),r=id[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},se=class{constructor(e){this.name=e,this._logLevel=nd,this._logHandler=rd,this._userLogHandler=null,ed.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?td[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}};var sd=(n,e)=>e.some(t=>n instanceof t),Ia,Ea;function od(){return Ia||(Ia=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ad(){return Ea||(Ea=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var wa=new WeakMap,lr=new WeakMap,Ta=new WeakMap,cr=new WeakMap,dr=new WeakMap;function cd(n){let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(oe(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&wa.set(t,n)}).catch(()=>{}),dr.set(e,n),e}function ld(n){if(lr.has(n))return;let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});lr.set(n,e)}var ur={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return lr.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ta.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return oe(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ca(n){ur=n(ur)}function ud(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(Vn(this),e,...t);return Ta.set(i,e.sort?e.sort():[e]),oe(i)}:ad().includes(n)?function(...e){return n.apply(Vn(this),e),oe(wa.get(this))}:function(...e){return oe(n.apply(Vn(this),e))}}function dd(n){return typeof n=="function"?ud(n):(n instanceof IDBTransaction&&ld(n),sd(n,od())?new Proxy(n,ur):n)}function oe(n){if(n instanceof IDBRequest)return cd(n);if(cr.has(n))return cr.get(n);let e=dd(n);return e!==n&&(cr.set(n,e),dr.set(e,n)),e}var Vn=n=>dr.get(n);function Sa(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(n,e),a=oe(o);return i&&o.addEventListener("upgradeneeded",c=>{i(oe(o.result),c.oldVersion,c.newVersion,oe(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var hd=["get","getKey","getAll","getAllKeys","count"],fd=["put","add","delete","clear"],hr=new Map;function ba(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(hr.get(e))return hr.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,r=fd.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||hd.includes(t)))return;let s=function(o,...a){return f(this,null,function*(){let c=this.transaction(o,r?"readwrite":"readonly"),l=c.store;return i&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),r&&c.done]))[0]})};return hr.set(e,s),s}Ca(n=>Ot(xe({},n),{get:(e,t,i)=>ba(e,t)||n.get(e,t,i),has:(e,t)=>!!ba(e,t)||n.has(e,t)}));var pr=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pd(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function pd(n){let e=n.getComponent();return e?.type==="VERSION"}var _r="@firebase/app",Aa="0.13.2";var fe=new se("@firebase/app"),_d="@firebase/app-compat",md="@firebase/analytics-compat",gd="@firebase/analytics",vd="@firebase/app-check-compat",yd="@firebase/app-check",Id="@firebase/auth",Ed="@firebase/auth-compat",wd="@firebase/database",Td="@firebase/data-connect",Cd="@firebase/database-compat",bd="@firebase/functions",Sd="@firebase/functions-compat",Ad="@firebase/installations",kd="@firebase/installations-compat",Rd="@firebase/messaging",Pd="@firebase/messaging-compat",Nd="@firebase/performance",Od="@firebase/performance-compat",Dd="@firebase/remote-config",Ld="@firebase/remote-config-compat",Md="@firebase/storage",xd="@firebase/storage-compat",Fd="@firebase/firestore",Ud="@firebase/ai",Wd="@firebase/firestore-compat",Vd="firebase",Hd="11.10.0";var mr="[DEFAULT]",Bd={[_r]:"fire-core",[_d]:"fire-core-compat",[gd]:"fire-analytics",[md]:"fire-analytics-compat",[yd]:"fire-app-check",[vd]:"fire-app-check-compat",[Id]:"fire-auth",[Ed]:"fire-auth-compat",[wd]:"fire-rtdb",[Td]:"fire-data-connect",[Cd]:"fire-rtdb-compat",[bd]:"fire-fn",[Sd]:"fire-fn-compat",[Ad]:"fire-iid",[kd]:"fire-iid-compat",[Rd]:"fire-fcm",[Pd]:"fire-fcm-compat",[Nd]:"fire-perf",[Od]:"fire-perf-compat",[Dd]:"fire-rc",[Ld]:"fire-rc-compat",[Md]:"fire-gcs",[xd]:"fire-gcs-compat",[Fd]:"fire-fst",[Wd]:"fire-fst-compat",[Ud]:"fire-vertex","fire-js":"fire-js",[Vd]:"fire-js-all"};var Ht=new Map,$d=new Map,gr=new Map;function ka(n,e){try{n.container.addComponent(e)}catch(t){fe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function X(n){let e=n.name;if(gr.has(e))return fe.debug(`There were multiple attempts to register component ${e}.`),!1;gr.set(e,n);for(let t of Ht.values())ka(t,n);for(let t of $d.values())ka(t,n);return!0}function dt(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function H(n){return n==null?!1:n.settings!==void 0}var jd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},we=new J("app","Firebase",jd);var vr=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new F("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw we.create("app-deleted",{appName:this._name})}};var Te=Hd;function Er(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:mr,automaticDataCollectionEnabled:!0},e),r=i.name;if(typeof r!="string"||!r)throw we.create("bad-app-name",{appName:String(r)});if(t||(t=or()),!t)throw we.create("no-options");let s=Ht.get(r);if(s){if(re(t,s.options)&&re(i,s.config))return s;throw we.create("duplicate-app",{appName:r})}let o=new Vt(r);for(let c of gr.values())o.addComponent(c);let a=new vr(t,i,o);return Ht.set(r,a),a}function $e(n=mr){let e=Ht.get(n);if(!e&&n===mr&&or())return Er();if(!e)throw we.create("no-app",{appName:n});return e}function Hn(){return Array.from(Ht.values())}function N(n,e,t){var i;let r=(i=Bd[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);let s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),fe.warn(a.join(" "));return}X(new F(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var zd="firebase-heartbeat-database",qd=1,Bt="firebase-heartbeat-store",fr=null;function Oa(){return fr||(fr=Sa(zd,qd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Bt)}catch(t){console.warn(t)}}}}).catch(n=>{throw we.create("idb-open",{originalErrorMessage:n.message})})),fr}function Gd(n){return f(this,null,function*(){try{let t=(yield Oa()).transaction(Bt),i=yield t.objectStore(Bt).get(Da(n));return yield t.done,i}catch(e){if(e instanceof Y)fe.warn(e.message);else{let t=we.create("idb-get",{originalErrorMessage:e?.message});fe.warn(t.message)}}})}function Ra(n,e){return f(this,null,function*(){try{let i=(yield Oa()).transaction(Bt,"readwrite");yield i.objectStore(Bt).put(e,Da(n)),yield i.done}catch(t){if(t instanceof Y)fe.warn(t.message);else{let i=we.create("idb-set",{originalErrorMessage:t?.message});fe.warn(i.message)}}})}function Da(n){return`${n.name}!${n.options.appId}`}var Kd=1024,Yd=30,yr=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ir(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return f(this,null,function*(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Pa();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>Yd){let o=Qd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){fe.warn(i)}})}getHeartbeatsHeader(){return f(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Pa(),{heartbeatsToSend:i,unsentEntries:r}=Jd(this._heartbeatsCache.heartbeats),s=Lt(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return fe.warn(t),""}})}};function Pa(){return new Date().toISOString().substring(0,10)}function Jd(n,e=Kd){let t=[],i=n.slice();for(let r of n){let s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),Na(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Na(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var Ir=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return f(this,null,function*(){return Un()?pa().then(()=>!0).catch(()=>!1):!1})}read(){return f(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Gd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ra(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ra(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function Na(n){return Lt(JSON.stringify({version:2,heartbeats:n})).length}function Qd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function Xd(n){X(new F("platform-logger",e=>new pr(e),"PRIVATE")),X(new F("heartbeat",e=>new yr(e),"PRIVATE")),N(_r,Aa,n),N(_r,Aa,"esm2017"),N("fire-js","")}Xd("");var Zd="firebase",eh="11.10.0";N(Zd,eh,"app");function La(n){n===void 0&&(n=he(st));let e=n.get(Dn);return t=>new ne(i=>{let r=e.add(),s=!1;function o(){s||(r(),s=!0)}let a=t.subscribe({next:c=>{i.next(c),o()},complete:()=>{i.complete(),o()},error:c=>{i.error(c),o()}});return a.add(()=>{i.unsubscribe(),o()}),a})}var ft=new ea("ANGULARFIRE2_VERSION");function wr(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var $n=(n,e)=>{let t=e?[e]:Hn(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},ht=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(ht||{}),Ma=Xi()&&typeof Zone<"u"?ht.WARN:ht.SILENT;var Bn=class{zone;delegate;constructor(e,t=Qo){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r?r.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,i)}},pt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=he(Ie);this.outsideAngular=t.runOutsideAngular(()=>new Bn(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Bn(typeof Zone>"u"?void 0:Zone.current,Jo))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),xa=!1;function th(n,e){!xa&&(Ma>ht.SILENT||Xi())&&(xa=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Ma>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function nh(n){let e=he(Ie,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function je(n){let e=he(Ie,{optional:!0});return e?e.run(()=>n()):n()}var ih=(n,e,t)=>(...i)=>(e&&setTimeout(e,0),On(t,()=>je(()=>n.apply(void 0,i)))),pe=(n,e,t)=>(t||=e?ht.WARN:ht.VERBOSE,function(){let i,r=arguments,s,o,a;try{s=he(pt),o=he(Dn),a=he(Xo)}catch{return th(n,t),n.apply(this,r)}for(let l=0;l<arguments.length;l++)typeof r[l]=="function"&&(e&&(i||=je(()=>o.add())),r[l]=ih(r[l],i,a));let c=nh(()=>n.apply(this,r));return e?c instanceof ne?c.pipe(Qi(s.outsideAngular),Ji(s.insideAngular),La(a)):c instanceof Promise?je(()=>{let l=o.add();return new Promise((d,h)=>{c.then(u=>On(a,()=>je(()=>d(u))),u=>On(a,()=>je(()=>h(u)))).finally(l)})}):typeof c=="function"&&i?function(){return setTimeout(i,0),c.apply(this,arguments)}:je(()=>c):c instanceof ne?c.pipe(Qi(s.outsideAngular),Ji(s.insideAngular)):je(()=>c)});var _e=class{constructor(e){return e}},$t=class{constructor(){return Hn()}};function rh(n){return n&&n.length===1?n[0]:new _e($e())}var Tr=new Rn("angularfire2._apps"),sh={provide:_e,useFactory:rh,deps:[[new Ue,Tr]]},oh={provide:$t,deps:[[new Ue,Tr]]};function ah(n){return(e,t)=>{let i=t.get(Zo);N("angularfire",ft.full,"core"),N("angularfire",ft.full,"app"),N("angular",ta.full,i.toString());let r=e.runOutsideAngular(()=>n(t));return new _e(r)}}function Xv(n,...e){return Nn([sh,oh,{provide:Tr,useFactory:ah(n),multi:!0,deps:[Ie,st,pt,...e]}])}var Zv=pe(Er,!0);var lh=new Map,uh={activated:!1,tokenObservers:[]},dh={initialized:!1,enabled:!1};function Z(n){return lh.get(n)||Object.assign({},uh)}function Ha(){return dh}var hh="https://content-firebaseappcheck.googleapis.com/v1";var fh="exchangeDebugToken",Ua={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ay=24*60*60*1e3;var Sr=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return f(this,null,function*(){this.stop();try{this.pending=new j,this.pending.promise.catch(t=>{}),yield ph(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new j,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function ph(n){return new Promise(e=>{setTimeout(e,n)})}var _h={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Ce=new J("appCheck","AppCheck",_h);function Ba(n){if(!Z(n).activated)throw Ce.create("use-before-activation",{appName:n.name})}function $a(i,r){return f(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(p){throw Ce.create("fetch-network-error",{originalErrorMessage:p?.message})}if(c.status!==200)throw Ce.create("fetch-status-error",{httpStatus:c.status});let l;try{l=yield c.json()}catch(p){throw Ce.create("fetch-parse-error",{originalErrorMessage:p?.message})}let d=l.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Ce.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let h=Number(d[1])*1e3,u=Date.now();return{token:l.token,expireTimeMillis:u+h,issuedAtTimeMillis:u}})}function ja(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${hh}/projects/${t}/apps/${i}:${fh}?key=${r}`,body:{debug_token:e}}}var mh="firebase-app-check-database",gh=1,Ar="firebase-app-check-store";var jn=null;function vh(){return jn||(jn=new Promise((n,e)=>{try{let t=indexedDB.open(mh,gh);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Ce.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Ar,{keyPath:"compositeKey"})}}}catch(t){e(Ce.create("storage-open",{originalErrorMessage:t?.message}))}}),jn)}function yh(n,e){return Ih(Eh(n),e)}function Ih(n,e){return f(this,null,function*(){let i=(yield vh()).transaction(Ar,"readwrite"),s=i.objectStore(Ar).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(Ce.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})})}function Eh(n){return`${n.options.appId}-${n.name}`}var jt=new se("@firebase/app-check");function Cr(n,e){return Un()?yh(n,e).catch(t=>{jt.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function za(){return Ha().enabled}function qa(){return f(this,null,function*(){let n=Ha();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var wh={error:"UNKNOWN_ERROR"};function Th(n){return ct.encodeString(JSON.stringify(n),!1)}function kr(n,e=!1,t=!1){return f(this,null,function*(){let i=n.app;Ba(i);let r=Z(i),s=r.token,o;if(s&&!zt(s)&&(r.token=void 0,s=void 0),!s){let l=yield r.cachedTokenPromise;l&&(zt(l)?s=l:yield Cr(i,void 0))}if(!e&&s&&zt(s))return{token:s.token};let a=!1;if(za())try{r.exchangeTokenPromise||(r.exchangeTokenPromise=$a(ja(i,yield qa()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);let l=yield r.exchangeTokenPromise;return yield Cr(i,l),r.token=l,{token:l.token}}catch(l){return l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?jt.warn(l.message):t&&jt.error(l),br(l)}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),s=yield Z(i).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?jt.warn(l.message):t&&jt.error(l),o=l}let c;return s?o?zt(s)?c={token:s.token,internalError:o}:c=br(o):(c={token:s.token},r.token=s,yield Cr(i,s)):c=br(o),a&&Ah(i,c),c})}function Ch(n){return f(this,null,function*(){let e=n.app;Ba(e);let{provider:t}=Z(e);if(za()){let i=yield qa(),{token:r}=yield $a(ja(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function bh(n,e,t,i){let{app:r}=n,s=Z(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&zt(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Wa(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Wa(n))}function Ga(n,e){let t=Z(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function Wa(n){let{app:e}=n,t=Z(e),i=t.tokenRefresher;i||(i=Sh(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Sh(n){let{app:e}=n;return new Sr(()=>f(null,null,function*(){let t=Z(e),i;if(t.token?i=yield kr(n,!0):i=yield kr(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Z(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},Ua.RETRIAL_MIN_WAIT,Ua.RETRIAL_MAX_WAIT)}function Ah(n,e){let t=Z(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function zt(n){return n.expireTimeMillis-Date.now()>0}function br(n){return{token:Th(wh),error:n}}var Rr=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Z(this.app);for(let t of e)Ga(this.app,t.next);return Promise.resolve()}};function kh(n,e){return new Rr(n,e)}function Rh(n){return{getToken:e=>kr(n,e),getLimitedUseToken:()=>Ch(n),addTokenListener:e=>bh(n,"INTERNAL",e),removeTokenListener:e=>Ga(n.app,e)}}var Ph="@firebase/app-check",Nh="0.10.1";var Oh="app-check",Va="app-check-internal";function Dh(){X(new F(Oh,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return kh(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Va).initialize()})),X(new F(Va,n=>{let e=n.getProvider("app-check").getImmediate();return Rh(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),N(Ph,Nh)}Dh();var Lh="app-check";var zn=class{constructor(){return $n(Lh)}};var Mh=["localhost","0.0.0.0","127.0.0.1"],Iy=typeof window<"u"&&Mh.includes(window.location.hostname);function lc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var uc=lc,dc=new J("auth","Firebase",lc());var Qn=new se("@firebase/auth");function xh(n,...e){Qn.logLevel<=b.WARN&&Qn.warn(`Auth (${Te}): ${n}`,...e)}function Gn(n,...e){Qn.logLevel<=b.ERROR&&Qn.error(`Auth (${Te}): ${n}`,...e)}function ce(n,...e){throw es(n,...e)}function ze(n,...e){return es(n,...e)}function hc(n,e,t){let i=Object.assign(Object.assign({},uc()),{[e]:t});return new J("auth","Firebase",i).create(e,{appName:n.name})}function ve(n){return hc(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function es(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return dc.create(n,...e)}function g(n,e,...t){if(!n)throw es(e,...t)}function me(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Gn(e),new Error(e)}function Ae(n,e){n||me(e)}function Dr(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Fh(){return Ka()==="http:"||Ka()==="https:"}function Ka(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function Uh(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fh()||ha()||"connection"in navigator)?navigator.onLine:!0}function Wh(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var qe=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ae(t>e,"Short delay should be less than long delay!"),this.isMobile=Mt()||Fn()}get(){return Uh()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function ts(n,e){Ae(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Xn=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;me("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;me("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;me("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Vh={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Hh=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Bh=new qe(3e4,6e4);function ke(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Re(s,o,a,c){return f(this,arguments,function*(n,e,t,i,r={}){return fc(n,r,()=>f(null,null,function*(){let l={},d={};i&&(e==="GET"?d=i:l={body:JSON.stringify(i)});let h=He(Object.assign({key:n.config.apiKey},d)).slice(1),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);let p=Object.assign({method:e,headers:u},l);return da()||(p.referrerPolicy="no-referrer"),n.emulatorConfig&&Ee(n.emulatorConfig.host)&&(p.credentials="include"),Xn.fetch()(yield pc(n,n.config.apiHost,t,h),p)}))})}function fc(n,e,t){return f(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},Vh),e);try{let r=new Lr(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw qn(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw qn(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw qn(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw qn(n,"user-disabled",o);let d=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw hc(n,d,l);ce(n,d)}}catch(r){if(r instanceof Y)throw r;ce(n,"network-request-failed",{message:String(r)})}})}function en(s,o,a,c){return f(this,arguments,function*(n,e,t,i,r={}){let l=yield Re(n,e,t,i,r);return"mfaPendingCredential"in l&&ce(n,"multi-factor-auth-required",{_serverResponse:l}),l})}function pc(n,e,t,i){return f(this,null,function*(){let r=`${e}${t}?${i}`,s=n,o=s.config.emulator?ts(n.config,r):`${n.config.apiScheme}://${r}`;return Hh.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function $h(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Lr=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(ze(this.auth,"network-request-failed")),Bh.get())})}};function qn(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let r=ze(n,e,i);return r.customData._tokenResponse=t,r}function Ya(n){return n!==void 0&&n.enterprise!==void 0}var Mr=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return $h(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function jh(n,e){return f(this,null,function*(){return Re(n,"GET","/v2/recaptchaConfig",ke(n,e))})}function zh(n,e){return f(this,null,function*(){return Re(n,"POST","/v1/accounts:delete",e)})}function Zn(n,e){return f(this,null,function*(){return Re(n,"POST","/v1/accounts:lookup",e)})}function Gt(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ns(n,e=!1){return f(this,null,function*(){let t=O(n),i=yield t.getIdToken(e),r=is(i);g(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Gt(Pr(r.auth_time)),issuedAtTime:Gt(Pr(r.iat)),expirationTime:Gt(Pr(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Pr(n){return Number(n)*1e3}function is(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Gn("JWT malformed, contained fewer than 3 sections"),null;try{let r=ot(t);return r?JSON.parse(r):(Gn("Failed to decode base64 JWT payload"),null)}catch(r){return Gn("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Ja(n){let e=is(n);return g(e,"internal-error"),g(typeof e.exp<"u","internal-error"),g(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Yt(n,e,t=!1){return f(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof Y&&qh(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function qh({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var xr=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>f(this,null,function*(){yield this.iteration()}),t)}iteration(){return f(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Jt=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gt(this.lastLoginAt),this.creationTime=Gt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ei(n){return f(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),r=yield Yt(n,Zn(t,{idToken:i}));g(r?.users.length,t,"internal-error");let s=r.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?_c(s.providerUserInfo):[],a=Gh(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,d=c?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Jt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,h)})}function rs(n){return f(this,null,function*(){let e=O(n);yield ei(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Gh(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function _c(n){return n.map(e=>{var{providerId:t}=e,i=Yi(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function Kh(n,e){return f(this,null,function*(){let t=yield fc(n,{},()=>f(null,null,function*(){let i=He({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=yield pc(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let c={method:"POST",headers:a,body:i};return n.emulatorConfig&&Ee(n.emulatorConfig.host)&&(c.credentials="include"),Xn.fetch()(o,c)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Yh(n,e){return f(this,null,function*(){return Re(n,"POST","/v2/accounts:revokeToken",ke(n,e))})}var Kt=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(typeof e.idToken<"u","internal-error"),g(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ja(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){g(e.length!==0,"internal-error");let t=Ja(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return f(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(g(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return f(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield Kh(e,t);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new n;return i&&(g(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(g(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(g(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return me("not implemented")}};function be(n,e){g(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Se=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=Yi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new xr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Jt(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return f(this,null,function*(){let t=yield Yt(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ns(this,e)}reload(){return rs(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return f(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield ei(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return f(this,null,function*(){if(H(this.auth.app))return Promise.reject(ve(this.auth));let e=yield this.getIdToken();return yield Yt(this,zh(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,l,d;let h=(i=t.displayName)!==null&&i!==void 0?i:void 0,u=(r=t.email)!==null&&r!==void 0?r:void 0,p=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,m=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,B=(l=t.createdAt)!==null&&l!==void 0?l:void 0,$=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:K,emailVerified:it,isAnonymous:Ko,providerData:Gi,stsTokenManager:Yo}=t;g(K&&Yo,e,"internal-error");let Wu=Kt.fromJSON(this.name,Yo);g(typeof K=="string",e,"internal-error"),be(h,e.name),be(u,e.name),g(typeof it=="boolean",e,"internal-error"),g(typeof Ko=="boolean",e,"internal-error"),be(p,e.name),be(m,e.name),be(w,e.name),be(A,e.name),be(B,e.name),be($,e.name);let Ki=new n({uid:K,auth:e,email:u,emailVerified:it,displayName:h,isAnonymous:Ko,photoURL:m,phoneNumber:p,tenantId:w,stsTokenManager:Wu,createdAt:B,lastLoginAt:$});return Gi&&Array.isArray(Gi)&&(Ki.providerData=Gi.map(Vu=>Object.assign({},Vu))),A&&(Ki._redirectEventId=A),Ki}static _fromIdTokenResponse(e,t,i=!1){return f(this,null,function*(){let r=new Kt;r.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield ei(s),s})}static _fromGetAccountInfoResponse(e,t,i){return f(this,null,function*(){let r=t.users[0];g(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?_c(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Kt;a.updateFromIdToken(i);let c=new n({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Jt(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(c,l),c})}};var Qa=new Map;function ge(n){Ae(n instanceof Function,"Expected a class definition");let e=Qa.get(n);return e?(Ae(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Qa.set(n,e),e)}var Jh=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return f(this,null,function*(){return!0})}_set(t,i){return f(this,null,function*(){this.storage[t]=i})}_get(t){return f(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return f(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),Fr=Jh;function Kn(n,e,t){return`firebase:${n}:${e}:${t}`}var ti=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=Kn(this.userKey,r.apiKey,s),this.fullPersistenceKey=Kn("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return f(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Zn(this.auth,{idToken:e}).catch(()=>{});return t?Se._fromGetAccountInfoResponse(this.auth,t,e):null}return Se._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return f(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return f(this,null,function*(){if(!t.length)return new n(ge(Fr),e,i);let r=(yield Promise.all(t.map(l=>f(null,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),s=r[0]||ge(Fr),o=Kn(i,e.config.apiKey,e.name),a=null;for(let l of t)try{let d=yield l._get(o);if(d){let h;if(typeof d=="string"){let u=yield Zn(e,{idToken:d}).catch(()=>{});if(!u)break;h=yield Se._fromGetAccountInfoResponse(e,u,d)}else h=Se._fromJSON(e,d);l!==s&&(a=h),s=l;break}}catch{}let c=r.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new n(s,e,i):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(l=>f(null,null,function*(){if(l!==s)try{yield l._remove(o)}catch{}}))),new n(s,e,i))})}};function Xa(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yc(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mc(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ec(e))return"Blackberry";if(wc(e))return"Webos";if(gc(e))return"Safari";if((e.includes("chrome/")||vc(e))&&!e.includes("edge/"))return"Chrome";if(Ic(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function mc(n=x()){return/firefox\//i.test(n)}function gc(n=x()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function vc(n=x()){return/crios\//i.test(n)}function yc(n=x()){return/iemobile/i.test(n)}function Ic(n=x()){return/android/i.test(n)}function Ec(n=x()){return/blackberry/i.test(n)}function wc(n=x()){return/webos/i.test(n)}function ss(n=x()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Qh(n=x()){var e;return ss(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Xh(){return fa()&&document.documentMode===10}function Tc(n=x()){return ss(n)||Ic(n)||wc(n)||Ec(n)||/windows phone/i.test(n)||yc(n)}function Cc(n,e=[]){let t;switch(n){case"Browser":t=Xa(x());break;case"Worker":t=`${Xa(x())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Te}/${i}`}var Ur=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return f(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function Zh(t){return f(this,arguments,function*(n,e={}){return Re(n,"GET","/v2/passwordPolicy",ke(n,e))})}var ef=6,Wr=class{constructor(e){var t,i,r,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:ef,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Vr=class{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ni(this),this.idTokenSubscription=new ni(this),this.beforeStateQueue=new Ur(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ge(t)),this._initializationPromise=this.queue(()=>f(this,null,function*(){var i,r,s;if(!this._deleted&&(this.persistenceManager=yield ti.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return f(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return f(this,null,function*(){try{let t=yield Zn(this,{idToken:e}),i=yield Se._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return f(this,null,function*(){var t;if(H(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return f(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return f(this,null,function*(){try{yield ei(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Wh()}_delete(){return f(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return f(this,null,function*(){if(H(this.app))return Promise.reject(ve(this));let t=e?O(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return f(this,null,function*(){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>f(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return f(this,null,function*(){return H(this.app)?Promise.reject(ve(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return H(this.app)?Promise.reject(ve(this)):this.queue(()=>f(this,null,function*(){yield this.assertedPersistence.setPersistence(ge(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return f(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return f(this,null,function*(){let e=yield Zh(this),t=new Wr(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new J("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return f(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield Yh(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return f(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return f(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ge(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=yield ti.create(this,[ge(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return f(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>f(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return f(this,null,function*(){if(e===this.currentUser)return this.queue(()=>f(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let c=e.addObserver(t,i,r);return()=>{o=!0,c()}}else{let c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return f(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Cc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return f(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return f(this,null,function*(){var e;if(H(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&xh(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Ke(n){return O(n)}var ni=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=va(t=>this.observer=t)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var li={loadJS(){return f(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tf(n){li=n}function bc(n){return li.loadJS(n)}function nf(){return li.recaptchaEnterpriseScript}function rf(){return li.gapiScript}function Sc(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Hr=class{constructor(){this.enterprise=new Br}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Br=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var sf="recaptcha-enterprise",Ac="NO_RECAPTCHA",$r=class{constructor(e){this.type=sf,this.auth=Ke(e)}verify(e="verify",t=!1){return f(this,null,function*(){function i(s){return f(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,a)=>f(null,null,function*(){jh(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let l=new Mr(c);return s.tenantId==null?s._agentRecaptchaConfig=l:s._tenantRecaptchaConfigs[s.tenantId]=l,o(l.siteKey)}}).catch(c=>{a(c)})}))})}function r(s,o,a){let c=window.grecaptcha;Ya(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(l=>{o(l)}).catch(()=>{o(Ac)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Hr().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{i(this.auth).then(a=>{if(!t&&Ya(window.grecaptcha))r(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=nf();c.length!==0&&(c+=a),bc(c).then(()=>{r(a,s,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})})}};function qt(n,e,t,i=!1,r=!1){return f(this,null,function*(){let s=new $r(n),o;if(r)o=Ac;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let a=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){let c=a.phoneEnrollmentInfo.phoneNumber,l=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function jr(n,e,t,i,r){return f(this,null,function*(){var s,o;if(r==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let a=yield qt(n,e,t,t==="getOobCode");return i(n,a)}else return i(n,e).catch(a=>f(null,null,function*(){if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let c=yield qt(n,e,t,t==="getOobCode");return i(n,c)}else return Promise.reject(a)}));else if(r==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let a=yield qt(n,e,t);return i(n,a).catch(c=>f(null,null,function*(){var l;if(((l=n._getRecaptchaConfig())===null||l===void 0?void 0:l.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let d=yield qt(n,e,t,!1,!0);return i(n,d)}return Promise.reject(c)}))}else{let a=yield qt(n,e,t,!1,!0);return i(n,a)}else return Promise.reject(r+" provider is not supported.")})}function os(n,e){let t=dt(n,"auth");if(t.isInitialized()){let r=t.getImmediate(),s=t.getOptions();if(re(s,e??{}))return r;ce(r,"already-initialized")}return t.initialize({options:e})}function of(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(ge);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function as(n,e,t){let i=Ke(n);g(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");let r=!!t?.disableWarnings,s=kc(e),{host:o,port:a}=af(e),c=a===null?"":`:${a}`,l={url:`${s}//${o}${c}/`},d=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){g(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),g(re(l,i.config.emulator)&&re(d,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=d,i.settings.appVerificationDisabledForTesting=!0,Ee(o)?(Mn(`${s}//${o}${c}`),xn("Auth",!0)):r||cf()}function kc(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function af(n){let e=kc(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:Za(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:Za(o)}}}function Za(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function cf(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Qt=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return me("not implemented")}_getIdTokenResponse(e){return me("not implemented")}_linkToIdToken(e,t){return me("not implemented")}_getReauthenticationResolver(e){return me("not implemented")}};function lf(n,e){return f(this,null,function*(){return Re(n,"POST","/v1/accounts:signUp",e)})}function uf(n,e){return f(this,null,function*(){return en(n,"POST","/v1/accounts:signInWithPassword",ke(n,e))})}function df(n,e){return f(this,null,function*(){return en(n,"POST","/v1/accounts:signInWithEmailLink",ke(n,e))})}function hf(n,e){return f(this,null,function*(){return en(n,"POST","/v1/accounts:signInWithEmailLink",ke(n,e))})}var Xt=class n extends Qt{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new n(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return f(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jr(e,t,"signInWithPassword",uf,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return df(e,{email:this._email,oobCode:this._password});default:ce(e,"internal-error")}})}_linkToIdToken(e,t){return f(this,null,function*(){switch(this.signInMethod){case"password":let i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jr(e,i,"signUpPassword",lf,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hf(e,{idToken:t,email:this._email,oobCode:this._password});default:ce(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function Nr(n,e){return f(this,null,function*(){return en(n,"POST","/v1/accounts:signInWithIdp",ke(n,e))})}function ff(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function pf(n){let e=lt(ut(n)).link,t=e?lt(ut(e)).deep_link_id:null,i=lt(ut(n)).deep_link_id;return(i?lt(ut(i)).link:null)||i||t||e||n}var ii=class n{constructor(e){var t,i,r,s,o,a;let c=lt(ut(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,d=(i=c.oobCode)!==null&&i!==void 0?i:null,h=ff((r=c.mode)!==null&&r!==void 0?r:null);g(l&&d&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=d,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let t=pf(e);try{return new n(t)}catch{return null}}};var Rc=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,i){return Xt._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){let r=ii.parseLink(i);return g(r,"argument-error"),Xt._fromEmailAndCode(t,r.code,r.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),ri=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var zr=class extends ri{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function _f(n,e){return f(this,null,function*(){return en(n,"POST","/v1/accounts:signUp",ke(n,e))})}var _t=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return f(this,null,function*(){let s=yield Se._fromIdTokenResponse(e,i,r),o=ec(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:t})})}static _forOperation(e,t,i){return f(this,null,function*(){yield e._updateTokensIfNecessary(i,!0);let r=ec(i);return new n({user:e,providerId:r,_tokenResponse:i,operationType:t})})}};function ec(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var qr=class n extends Y{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new n(e,t,i,r)}};function Pc(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?qr._fromErrorAndOperation(n,s,e,i):s})}function mf(n,e,t=!1){return f(this,null,function*(){let i=yield Yt(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return _t._forOperation(n,"link",i)})}function gf(n,e,t=!1){return f(this,null,function*(){let{auth:i}=n;if(H(i.app))return Promise.reject(ve(i));let r="reauthenticate";try{let s=yield Yt(n,Pc(i,r,e,n),t);g(s.idToken,i,"internal-error");let o=is(s.idToken);g(o,i,"internal-error");let{sub:a}=o;return g(n.uid===a,i,"user-mismatch"),_t._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&ce(i,"user-mismatch"),s}})}function Nc(n,e,t=!1){return f(this,null,function*(){if(H(n.app))return Promise.reject(ve(n));let i="signIn",r=yield Pc(n,i,e),s=yield _t._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s})}function cs(n,e){return f(this,null,function*(){return Nc(Ke(n),e)})}function Oc(n){return f(this,null,function*(){let e=Ke(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function ls(n,e,t){return f(this,null,function*(){if(H(n.app))return Promise.reject(ve(n));let i=Ke(n),o=yield jr(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_f,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Oc(n),c}),a=yield _t._fromIdTokenResponse(i,"signIn",o);return yield i._updateCurrentUser(a.user),a})}function us(n,e,t){return H(n.app)?Promise.reject(ve(n)):cs(O(n),Rc.credential(e,t)).catch(i=>f(null,null,function*(){throw i.code==="auth/password-does-not-meet-requirements"&&Oc(n),i}))}function ui(n,e,t,i){return O(n).onIdTokenChanged(e,t,i)}function ds(n,e,t){return O(n).beforeAuthStateChanged(e,t)}function di(n,e,t,i){return O(n).onAuthStateChanged(e,t,i)}function hs(n){return O(n).signOut()}var si="__sak";var oi=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(si,"1"),this.storage.removeItem(si),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var vf=1e3,yf=10,If=(()=>{class n extends oi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Tc(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}let r=t.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);Xh()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,yf):s()}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},vf)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,i){return f(this,null,function*(){yield Fe(n.prototype,this,"_set").call(this,t,i),this.localCache[t]=JSON.stringify(i)})}_get(t){return f(this,null,function*(){let i=yield Fe(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(i),i})}_remove(t){return f(this,null,function*(){yield Fe(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Dc=If;var Ef=(()=>{class n extends oi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})(),fs=Ef;function wf(n){return Promise.all(n.map(e=>f(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Tf=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;let r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){return f(this,null,function*(){let i=t,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let c=Array.from(a).map(d=>f(this,null,function*(){return d(i.origin,o)})),l=yield wf(c);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Lc(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}var Gr=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){return f(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{let l=Lc("",20);r.port1.start();let d=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){let u=h;if(u.data.eventId===l)switch(u.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(u.data.response);break;default:clearTimeout(d),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function ae(){return window}function Cf(n){ae().location.href=n}function Mc(){return typeof ae().WorkerGlobalScope<"u"&&typeof ae().importScripts=="function"}function bf(){return f(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Sf(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Af(){return Mc()?self:null}var xc="firebaseLocalStorageDb",kf=1,ai="firebaseLocalStorage",Fc="fbase_key",Ge=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function hi(n,e){return n.transaction([ai],e?"readwrite":"readonly").objectStore(ai)}function Rf(){let n=indexedDB.deleteDatabase(xc);return new Ge(n).toPromise()}function Kr(){let n=indexedDB.open(xc,kf);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(ai,{keyPath:Fc})}catch(r){t(r)}}),n.addEventListener("success",()=>f(null,null,function*(){let i=n.result;i.objectStoreNames.contains(ai)?e(i):(i.close(),yield Rf(),e(yield Kr()))}))})}function tc(n,e,t){return f(this,null,function*(){let i=hi(n,!0).put({[Fc]:e,value:t});return new Ge(i).toPromise()})}function Pf(n,e){return f(this,null,function*(){let t=hi(n,!1).get(e),i=yield new Ge(t).toPromise();return i===void 0?null:i.value})}function nc(n,e){let t=hi(n,!0).delete(e);return new Ge(t).toPromise()}var Nf=800,Of=3,Df=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return f(this,null,function*(){return this.db?this.db:(this.db=yield Kr(),this.db)})}_withRetries(t){return f(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield t(r)}catch(r){if(i++>Of)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return f(this,null,function*(){return Mc()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return f(this,null,function*(){this.receiver=Tf._getInstance(Af()),this.receiver._subscribe("keyChanged",(t,i)=>f(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(t,i)=>f(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return f(this,null,function*(){var t,i;if(this.activeServiceWorker=yield bf(),!this.activeServiceWorker)return;this.sender=new Gr(this.activeServiceWorker);let r=yield this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return f(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Sf()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return f(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Kr();return yield tc(t,si,"1"),yield nc(t,si),!0}catch{}return!1})}_withPendingWrite(t){return f(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,i){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(r=>tc(r,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)}))})}_get(t){return f(this,null,function*(){let i=yield this._withRetries(r=>Pf(r,t));return this.localCache[t]=i,i})}_remove(t){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(i=>nc(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return f(this,null,function*(){let t=yield this._withRetries(s=>{let o=hi(s,!1).getAll();return new Ge(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>f(this,null,function*(){return this._poll()}),Nf)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Uc=Df;var ky=Sc("rcb"),Ry=new qe(3e4,6e4);function Lf(n,e){return e?ge(e):(g(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Zt=class extends Qt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Nr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Nr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Nr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Mf(n){return Nc(n.auth,new Zt(n),n.bypassAuthState)}function xf(n){let{auth:e,user:t}=n;return g(t,e,"internal-error"),gf(t,new Zt(n),n.bypassAuthState)}function Ff(n){return f(this,null,function*(){let{auth:e,user:t}=n;return g(t,e,"internal-error"),mf(t,new Zt(n),n.bypassAuthState)})}var Yr=class{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>f(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(e){return f(this,null,function*(){let{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Mf;case"linkViaPopup":case"linkViaRedirect":return Ff;case"reauthViaPopup":case"reauthViaRedirect":return xf;default:ce(this.auth,"internal-error")}}resolve(e){Ae(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ae(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Py=new qe(2e3,1e4);var Uf="pendingRedirect",Yn=new Map,Jr=class n extends Yr{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){return f(this,null,function*(){let e=Yn.get(this.auth._key());if(!e){try{let i=(yield Wf(this.resolver,this.auth))?yield Fe(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Yn.set(this.auth._key(),e)}return this.bypassAuthState||Yn.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return f(this,null,function*(){if(e.type==="signInViaRedirect")return Fe(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Fe(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return f(this,null,function*(){})}cleanUp(){}};function Wf(n,e){return f(this,null,function*(){let t=Bf(e),i=Hf(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(t))==="true";return yield i._remove(t),r})}function Vf(n,e){Yn.set(n._key(),e)}function Hf(n){return ge(n._redirectPersistence)}function Bf(n){return Kn(Uf,n.config.apiKey,n.name)}function $f(n,e,t=!1){return f(this,null,function*(){if(H(n.app))return Promise.reject(ve(n));let i=Ke(n),r=Lf(i,e),o=yield new Jr(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o})}var jf=10*60*1e3,Qr=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zf(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!Wc(e)){let r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jf&&this.cachedEventUids.clear(),this.cachedEventUids.has(ic(e))}saveEventToCache(e){this.cachedEventUids.add(ic(e)),this.lastProcessedEventTime=Date.now()}};function ic(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Wc({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function zf(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wc(n);default:return!1}}function qf(t){return f(this,arguments,function*(n,e={}){return Re(n,"GET","/v1/projects",e)})}var Gf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Kf=/^https?/;function Yf(n){return f(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield qf(n);for(let t of e)try{if(Jf(t))return}catch{}ce(n,"unauthorized-domain")})}function Jf(n){let e=Dr(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!Kf.test(t))return!1;if(Gf.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var Qf=new qe(3e4,6e4);function rc(){let n=ae().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Xf(n){return new Promise((e,t)=>{var i,r,s;function o(){rc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rc(),t(ze(n,"network-request-failed"))},timeout:Qf.get()})}if(!((r=(i=ae().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=ae().gapi)===null||s===void 0)&&s.load)o();else{let a=Sc("iframefcb");return ae()[a]=()=>{gapi.load?o():t(ze(n,"network-request-failed"))},bc(`${rf()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Jn=null,e})}var Jn=null;function Zf(n){return Jn=Jn||Xf(n),Jn}var ep=new qe(5e3,15e3),tp="__/auth/iframe",np="emulator/auth/iframe",ip={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function sp(n){let e=n.config;g(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?ts(e,np):`https://${n.config.authDomain}/${tp}`,i={apiKey:e.apiKey,appName:n.name,v:Te},r=rp.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${He(i).slice(1)}`}function op(n){return f(this,null,function*(){let e=yield Zf(n),t=ae().gapi;return g(t,n,"internal-error"),e.open({where:document.body,url:sp(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ip,dontclear:!0},i=>new Promise((r,s)=>f(null,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=ze(n,"network-request-failed"),a=ae().setTimeout(()=>{s(o)},ep.get());function c(){ae().clearTimeout(a),r(i)}i.ping(c).then(c,()=>{s(o)})})))})}var ap={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cp=500,lp=600,up="_blank",dp="http://localhost",ci=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function hp(n,e,t,i=cp,r=lp){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",c=Object.assign(Object.assign({},ap),{width:i.toString(),height:r.toString(),top:s,left:o}),l=x().toLowerCase();t&&(a=vc(l)?up:t),mc(l)&&(e=e||dp,c.scrollbars="yes");let d=Object.entries(c).reduce((u,[p,m])=>`${u}${p}=${m},`,"");if(Qh(l)&&a!=="_self")return fp(e||"",a),new ci(null);let h=window.open(e||"",a,d);g(h,n,"popup-blocked");try{h.focus()}catch{}return new ci(h)}function fp(n,e){let t=document.createElement("a");t.href=n,t.target=e;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}var pp="__/auth/handler",_p="emulator/auth/handler",mp=encodeURIComponent("fac");function sc(n,e,t,i,r,s){return f(this,null,function*(){g(n.config.authDomain,n,"auth-domain-config-required"),g(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Te,eventId:r};if(e instanceof ri){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",xt(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[d,h]of Object.entries(s||{}))o[d]=h}if(e instanceof zr){let d=e.getScopes().filter(h=>h!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let d of Object.keys(a))a[d]===void 0&&delete a[d];let c=yield n._getAppCheckToken(),l=c?`#${mp}=${encodeURIComponent(c)}`:"";return`${gp(n)}?${He(a).slice(1)}${l}`})}function gp({config:n}){return n.emulator?ts(n,_p):`https://${n.authDomain}/${pp}`}var Or="webStorageSupport",Xr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fs,this._completeRedirectFn=$f,this._overrideRedirectResult=Vf}_openPopup(e,t,i,r){return f(this,null,function*(){var s;Ae((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield sc(e,t,i,Dr(),r);return hp(e,o,Lc())})}_openRedirect(e,t,i,r){return f(this,null,function*(){yield this._originValidation(e);let s=yield sc(e,t,i,Dr(),r);return Cf(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Ae(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){return f(this,null,function*(){let t=yield op(e),i=new Qr(e);return t.register("authEvent",r=>(g(r?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Or,{type:Or},r=>{var s;let o=(s=r?.[0])===null||s===void 0?void 0:s[Or];o!==void 0&&t(!!o),ce(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Yf(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Tc()||gc()||ss()}},Vc=Xr;var oc="@firebase/auth",ac="1.10.8";var Zr=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return f(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function vp(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function yp(n){X(new F("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;g(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Cc(n)},l=new Vr(i,r,s,c);return of(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),X(new F("auth-internal",e=>{let t=Ke(e.getProvider("auth").getImmediate());return(i=>new Zr(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),N(oc,ac,vp(n)),N(oc,ac,"esm2017")}var Ip=5*60,Ep=ar("authIdTokenMaxAge")||Ip,cc=null,wp=n=>e=>f(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>Ep)return;let r=t?.token;cc!==r&&(cc=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function ps(n=$e()){let e=dt(n,"auth");if(e.isInitialized())return e.getImmediate();let t=os(n,{popupRedirectResolver:Vc,persistence:[Uc,Dc,fs]}),i=ar("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=wp(s.toString());ds(t,o,()=>o(t.currentUser)),ui(t,a=>o(a))}}let r=sr("auth");return r&&as(t,`http://${r}`),t}function Tp(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}tf({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{let s=ze("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",Tp().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});yp("Browser");function Bc(n){return new ne(function(e){var t=di(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var $c="auth",Ye=class{constructor(e){return e}},_s=class{constructor(){return $n($c)}};var ms=new Rn("angularfire2.auth-instances");function u_(n,e){let t=wr($c,n,e);return t&&new Ye(t)}function d_(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Ye(i)}}var h_={provide:_s,deps:[[new Ue,ms]]},f_={provide:Ye,useFactory:u_,deps:[[new Ue,ms],_e]};function TI(n,...e){return N("angularfire",ft.full,"auth"),Nn([f_,h_,{provide:ms,useFactory:d_(n),multi:!0,deps:[Ie,st,pt,$t,[new Ue,zn],...e]}])}var jc=pe(Bc,!0);var zc=pe(ls,!0,2);var CI=pe(ps,!0);var qc=pe(us,!0,2);var Gc=pe(hs,!0,2);var Kc=class n{constructor(e){this.auth=e;this.user$=jc(this.auth)}user$;register(e,t){return zc(this.auth,e,t)}login(e,t){return qc(this.auth,e,t)}logout(){return Gc(this.auth)}static \u0275fac=function(t){return new(t||n)(Pn(Ye))};static \u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"})};var Yc="@firebase/database",Jc="1.0.20";var Io="";function __(n){Io=n}var Cs=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:at(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var bs=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Q(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var kl=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Cs(e)}}catch{}return new bs},Qe=kl("localStorage"),Ss=kl("sessionStorage");var vt=new se("@firebase/database"),m_=function(){let n=1;return function(){return n++}}(),Rl=function(n){let e=ya(n),t=new Ln;t.update(e);let i=t.digest();return ct.encodeByteArray(i)},En=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=En.apply(null,i):typeof i=="object"?e+=P(i):e+=i,e+=" "}return e},Xe=null,Qc=!0,g_=function(n,e){_(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(vt.logLevel=b.VERBOSE,Xe=vt.log.bind(vt),e&&Ss.set("logging_enabled",!0)):typeof n=="function"?Xe=n:(Xe=null,Ss.remove("logging_enabled"))},L=function(...n){if(Qc===!0&&(Qc=!1,Xe===null&&Ss.get("logging_enabled")===!0&&g_(!0)),Xe){let e=En.apply(null,n);Xe(e)}},wn=function(n){return function(...e){L(n,...e)}},As=function(...n){let e="FIREBASE INTERNAL ERROR: "+En(...n);vt.error(e)},ye=function(...n){let e=`FIREBASE FATAL ERROR: ${En(...n)}`;throw vt.error(e),new Error(e)},W=function(...n){let e="FIREBASE WARNING: "+En(...n);vt.warn(e)},v_=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&W("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Eo=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},y_=function(n){if(ie()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},It="[MIN_NAME]",Ze="[MAX_NAME]",tt=function(n,e){if(n===e)return 0;if(n===It||e===Ze)return-1;if(e===It||n===Ze)return 1;{let t=Xc(n),i=Xc(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},I_=function(n,e){return n===e?0:n<e?-1:1},tn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+P(e))},wo=function(n){if(typeof n!="object"||n===null)return P(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=P(e[i]),t+=":",t+=wo(n[e[i]]);return t+="}",t},Pl=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function M(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Nl=function(n){_(!Eo(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(r?1:0),l.reverse();let d=l.join(""),h="";for(c=0;c<64;c+=8){let u=parseInt(d.substr(c,8),2).toString(16);u.length===1&&(u="0"+u),h=h+u}return h.toLowerCase()},E_=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},w_=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function T_(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var C_=new RegExp("^-?(0*)\\d{1,10}$"),b_=-2147483648,S_=2147483647,Xc=function(n){if(C_.test(n)){let e=Number(n);if(e>=b_&&e<=S_)return e}return null},Rt=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw W("Exception was thrown by user callback.",t),e},Math.floor(0))}},A_=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},an=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var ks=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,H(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){W(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Rs=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(L("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',W(e)}},cn=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),pi="5",Ol="v",Dl="s",Ll="r",Ml="f",xl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Fl="ls",Ul="p",Ps="ac",Wl="websocket",Vl="long_polling";var _i=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1,l=null){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Qe.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Qe.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function k_(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Hl(n,e,t){_(typeof e=="string","typeof type must == string"),_(typeof t=="object","typeof params must == object");let i;if(e===Wl)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Vl)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);k_(n)&&(t.ns=n.namespace);let r=[];return M(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var Ns=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Q(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return oa(this.counters_)}};var gs={},vs={};function To(n){let e=n.toString();return gs[e]||(gs[e]=new Ns),gs[e]}function R_(n,e){let t=n.toString();return vs[t]||(vs[t]=e()),vs[t]}var Os=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Rt(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Zc="start",P_="close",N_="pLPCommand",O_="pRTLPCB",Bl="id",$l="pw",jl="ser",D_="cb",L_="seg",M_="ts",x_="d",F_="dframe",zl=1870,ql=30,U_=zl-ql,W_=25e3,V_=3e4,Ds=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wn(e),this.stats_=To(t),this.urlFn=c=>(this.appCheckToken&&(c[Ps]=this.appCheckToken),Hl(t,Vl,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Os(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(V_)),y_(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ls((...s)=>{let[o,a,c,l,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Zc)this.id=a,this.password=c;else if(o===P_)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Zc]="t",i[jl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[D_]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Ol]=pi,this.transportSessionId&&(i[Dl]=this.transportSessionId),this.lastSessionId&&(i[Fl]=this.lastSessionId),this.applicationId&&(i[Ul]=this.applicationId),this.appCheckToken&&(i[Ps]=this.appCheckToken),typeof location<"u"&&location.hostname&&xl.test(location.hostname)&&(i[Ll]=Ml);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return ie()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!E_()&&!w_()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=ir(t),r=Pl(i,U_);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ie())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[F_]="t",i[Bl]=e,i[$l]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Ls=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ie())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=m_(),window[N_+this.uniqueCallbackIdentifier]=e,window[O_+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){L("frame writing exception"),a.stack&&L(a.stack),L(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||L("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Bl]=this.myID,e[$l]=this.myPW,e[jl]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ql+i.length<=zl;){let o=this.pendingSegs.shift();i=i+"&"+L_+r+"="+o.seg+"&"+M_+r+"="+o.ts+"&"+x_+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(W_)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){ie()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{L("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var H_=16384,B_=45e3,mi=null;typeof MozWebSocket<"u"?mi=MozWebSocket:typeof WebSocket<"u"&&(mi=WebSocket);var nn=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wn(this.connId),this.stats_=To(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[Ol]=pi,!ie()&&typeof location<"u"&&location.hostname&&xl.test(location.hostname)&&(a[Ll]=Ml),i&&(a[Dl]=i),r&&(a[Fl]=r),s&&(a[Ps]=s),o&&(a[Ul]=o),Hl(t,Wl,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Qe.set("previous_websocket_failure",!0);try{let r;if(ie()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${pi}/${Io}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new mi(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&mi!==null&&!n.forceDisallow_}static previouslyFailed(){return Qe.isInMemoryStorage||Qe.get("previous_websocket_failure")===!0}markConnectionHealthy(){Qe.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=at(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(_(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=P(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=Pl(i,H_);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(B_))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),$_=(()=>{class n{static get ALL_TRANSPORTS(){return[Ds,nn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=nn&&nn.isAvailable(),r=i&&!nn.previouslyFailed();if(t.webSocketOnly&&(i||W("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[nn];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),j_=6e4,z_=5e3,q_=10*1024,G_=100*1024,ys="t",el="d",K_="s",tl="r",Y_="e",nl="o",il="a",rl="n",sl="p",J_="h",Ms=class{constructor(e,t,i,r,s,o,a,c,l,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wn("c:"+this.id+":"),this.transportManager_=new $_(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=an(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>G_?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>q_?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ys in e){let t=e[ys];t===il?this.upgradeIfSecondaryHealthy_():t===tl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===nl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=tn("t",e),i=tn("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:sl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:il,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:rl,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=tn("t",e),i=tn("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=tn(ys,e);if(el in e){let i=e[el];if(t===J_){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===rl){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===K_?this.onConnectionShutdown_(i):t===tl?this.onReset_(i):t===Y_?As("Server Error: "+i):t===nl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):As("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),pi!==i&&W("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),an(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(j_))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):an(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(z_))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:sl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Qe.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var gi=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var vi=class{constructor(e){this.allowedEvents_=e,this.listeners_={},_(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){_(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var yi=class n extends vi{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Mt()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return _(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ol=32,al=768,C=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function T(){return new C("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function De(n){return n.pieces_.length-n.pieceNum_}function S(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new C(n.pieces_,e)}function Co(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Q_(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function hn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Gl(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new C(e,0)}function k(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof C)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new C(t,0)}function E(n){return n.pieceNum_>=n.pieces_.length}function U(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return U(S(n),S(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function X_(n,e){let t=hn(n,0),i=hn(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=tt(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function bo(n,e){if(De(n)!==De(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function z(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(De(n)>De(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var xs=class{constructor(e,t){this.errorPrefix_=t,this.parts_=hn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Wt(this.parts_[i]);Kl(this)}};function Z_(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Wt(e),Kl(n)}function em(n){let e=n.parts_.pop();n.byteLength_-=Wt(e),n.parts_.length>0&&(n.byteLength_-=1)}function Kl(n){if(n.byteLength_>al)throw new Error(n.errorPrefix_+"has a key path longer than "+al+" bytes ("+n.byteLength_+").");if(n.parts_.length>ol)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ol+") or object contains a cycle "+Je(n))}function Je(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Fs=class n extends vi{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return _(e==="visible","Unknown event type: "+e),[this.visible_]}};var rn=1e3,tm=60*5*1e3,cl=30*1e3,nm=1.3,im=3e4,rm="server_kill",ll=3,So=(()=>{class n extends gi{constructor(t,i,r,s,o,a,c,l){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=wn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=rn,this.maxReconnectDelay_=tm,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!ie())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Fs.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&yi.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(P(o)),_(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new j,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,d=c.s;n.warnOnListenWarnings_(l,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,l))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&Q(t,"w")){let r=Ve(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();W(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ga(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=cl)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=ma(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+P(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):As("Unrecognized action received from server: "+P(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){_(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>im&&(this.reconnectDelay_=rn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*nm)}this.onConnectStatus_(!1)}establishConnection_(){return f(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,r())},d=function(u){_(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(u)};this.realtime_={close:l,sendRequest:d};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[u,p]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?L("getToken() completed but was canceled"):(L("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=p&&p.token,c=new Ms(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,m=>{W(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(rm)},o))}catch(u){this.log_("Failed to get token: "+u),a||(this.repoInfo_.nodeAdmin&&W(u),l())}}})}interrupt(t){L("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){L("Resuming connection for reason: "+t),delete this.interruptReasons_[t],xt(this.interruptReasons_)&&(this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>wo(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new C(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){L("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ll&&(this.reconnectDelay_=cl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){L("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ll&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";ie()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Io.replace(/\./g,"-")]=1,Mt()?t["framework.cordova"]=1:Fn()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=yi.getInstance().currentlyOnline();return xt(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),I=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Et=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new I(It,e),r=new I(It,t);return this.compare(i,r)!==0}minPost(){return I.MIN}};var fi,Ii=class extends Et{static get __EMPTY_NODE(){return fi}static set __EMPTY_NODE(e){fi=e}compare(e,t){return tt(e.name,t.name)}isDefinedOn(e){throw We("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return I.MIN}maxPost(){return new I(Ze,fi)}makePost(e,t){return _(typeof e=="string","KeyIndex indexValue must always be a string."),new I(e,fi)}toString(){return".key"}},yt=new Ii;var gt=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ee=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??q.EMPTY_NODE,this.right=o??q.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return q.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return q.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Us=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new ee(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},q=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ee.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ee.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new gt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new gt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new gt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new gt(this.root_,null,this.comparator_,!0,e)}};q.EMPTY_NODE=new Us;function sm(n,e){return tt(n.name,e.name)}function Ao(n,e){return tt(n,e)}var Ws;function om(n){Ws=n}var Yl=function(n){return typeof n=="number"?"number:"+Nl(n):"string:"+n},Jl=function(n){if(n.isLeafNode()){let e=n.val();_(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Q(e,".sv"),"Priority must be a string or number.")}else _(n===Ws||n.isEmpty(),"priority of unexpected type.");_(n===Ws||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var ul,wt=(()=>{class n{static set __childrenNodeConstructor(t){ul=t}static get __childrenNodeConstructor(){return ul}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,_(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Jl(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return E(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=y(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(_(r!==".priority"||De(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(S(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Yl(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Nl(this.value_):t+=this.value_,this.lazyHash_=Rl(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(_(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return _(s>=0,"Unknown leaf type: "+i),_(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Ql,Xl;function am(n){Ql=n}function cm(n){Xl=n}var Vs=class extends Et{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?tt(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return I.MIN}maxPost(){return new I(Ze,new wt("[PRIORITY-POST]",Xl))}makePost(e,t){let i=Ql(e);return new I(t,new wt("[PRIORITY-POST]",i))}toString(){return".priority"}},R=new Vs;var lm=Math.log(2),Hs=class{constructor(e){let t=s=>parseInt(Math.log(s)/lm,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Ei=function(n,e,t,i){n.sort(e);let r=function(c,l){let d=l-c,h,u;if(d===0)return null;if(d===1)return h=n[c],u=t?t(h):h,new ee(u,h.node,ee.BLACK,null,null);{let p=parseInt(d/2,10)+c,m=r(c,p),w=r(p+1,l);return h=n[p],u=t?t(h):h,new ee(u,h.node,ee.BLACK,m,w)}},s=function(c){let l=null,d=null,h=n.length,u=function(m,w){let A=h-m,B=h;h-=m;let $=r(A+1,B),K=n[A],it=t?t(K):K;p(new ee(it,K.node,w,null,$))},p=function(m){l?(l.left=m,l=m):(d=m,l=m)};for(let m=0;m<c.count;++m){let w=c.nextBitIsOne(),A=Math.pow(2,c.count-(m+1));w?u(A,ee.BLACK):(u(A,ee.BLACK),u(A,ee.RED))}return d},o=new Hs(n.length),a=s(o);return new q(i||e,a)};var Is,mt={},Tt=class n{static get Default(){return _(mt&&R,"ChildrenNode.ts has not been loaded"),Is=Is||new n({".priority":mt},{".priority":R}),Is}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=Ve(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof q?t:null}hasIndex(e){return Q(this.indexSet_,e.toString())}addIndex(e,t){_(e!==yt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(I.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Ei(i,e.getCompare()):a=mt;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,l)}addToIndexes(e,t){let i=Ft(this.indexes_,(r,s)=>{let o=Ve(this.indexSet_,s);if(_(o,"Missing index implementation for "+s),r===mt)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(I.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Ei(a,o.getCompare())}else return mt;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new I(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=Ft(this.indexes_,r=>{if(r===mt)return r;{let s=t.get(e.name);return s?r.remove(new I(e.name,s)):r}});return new n(i,this.indexSet_)}};var sn,v=(()=>{class n{static get EMPTY_NODE(){return sn||(sn=new n(new q(Ao),null,Tt.Default))}constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Jl(this.priorityNode_),this.children_.isEmpty()&&_(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||sn}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?sn:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(S(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(_(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new I(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?sn:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=y(t);if(r===null)return i;{_(y(t)!==".priority"||De(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(S(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(R,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Yl(this.getPriority().val())+":"),this.forEachChild(R,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":Rl(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new I(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new I(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new I(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,I.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,I.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Tn?-1:0}withIndex(t){if(t===yt||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===yt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(R),s=i.getIterator(R),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===yt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Bs=class extends v{constructor(){super(new q(Ao),v.EMPTY_NODE,Tt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return v.EMPTY_NODE}isEmpty(){return!1}},Tn=new Bs;Object.defineProperties(I,{MIN:{value:new I(It,v.EMPTY_NODE)},MAX:{value:new I(Ze,Tn)}});Ii.__EMPTY_NODE=v.EMPTY_NODE;wt.__childrenNodeConstructor=v;om(Tn);cm(Tn);var um=!0;function D(n,e=null){if(n===null)return v.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),_(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new wt(t,D(e))}if(!(n instanceof Array)&&um){let t=[],i=!1;if(M(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=D(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new I(o,c)))}}),t.length===0)return v.EMPTY_NODE;let s=Ei(t,sm,o=>o.name,Ao);if(i){let o=Ei(t,R.getCompare());return new v(s,D(e),new Tt({".priority":o},{".priority":R}))}else return new v(s,D(e),Tt.Default)}else{let t=v.EMPTY_NODE;return M(n,(i,r)=>{if(Q(n,i)&&i.substring(0,1)!=="."){let s=D(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(D(e))}}am(D);var $s=class extends Et{constructor(e){super(),this.indexPath_=e,_(!E(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?tt(e.name,t.name):s}makePost(e,t){let i=D(e),r=v.EMPTY_NODE.updateChild(this.indexPath_,i);return new I(t,r)}maxPost(){let e=v.EMPTY_NODE.updateChild(this.indexPath_,Tn);return new I(Ze,e)}toString(){return hn(this.indexPath_,0).join("/")}};var js=class extends Et{compare(e,t){let i=e.node.compareTo(t.node);return i===0?tt(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return I.MIN}maxPost(){return I.MAX}makePost(e,t){let i=D(e);return new I(t,i)}toString(){return".value"}},dm=new js;function Zl(n){return{type:"value",snapshotNode:n}}function Ct(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function fn(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function pn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function hm(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var _n=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){_(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(fn(t,a)):_(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ct(t,i)):o.trackChildChange(pn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(R,(r,s)=>{t.hasChild(r)||i.trackChildChange(fn(r,s))}),t.isLeafNode()||t.forEachChild(R,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(pn(r,s,o))}else i.trackChildChange(Ct(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?v.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var wi=class n{constructor(e){this.indexedFilter_=new _n(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new I(t,i))||(i=v.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=v.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(v.EMPTY_NODE);let s=this;return t.forEachChild(R,(o,a)=>{s.matches(new I(o,a))||(r=r.updateImmediateChild(o,v.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var zs=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new wi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new I(t,i))||(i=v.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=v.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=v.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(v.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,v.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let h=this.index_.getCompare();o=(u,p)=>h(p,u)}else o=this.index_.getCompare();let a=e;_(a.numChildren()===this.limit_,"");let c=new I(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let h=a.getImmediateChild(t),u=r.getChildAfterChild(this.index_,l,this.reverse_);for(;u!=null&&(u.name===t||a.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let p=u==null?1:o(u,c);if(d&&!i.isEmpty()&&p>=0)return s?.trackChildChange(pn(t,i,h)),a.updateImmediateChild(t,i);{s?.trackChildChange(fn(t,h));let w=a.updateImmediateChild(t,v.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(s?.trackChildChange(Ct(u.name,u.node)),w.updateImmediateChild(u.name,u.node)):w}}else return i.isEmpty()?e:d&&o(l,c)>=0?(s!=null&&(s.trackChildChange(fn(l.name,l.node)),s.trackChildChange(Ct(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,v.EMPTY_NODE)):e}};var qs=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=R}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:It}hasEnd(){return this.endSet_}getIndexEndValue(){return _(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ze}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===R}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function fm(n){return n.loadsAllData()?new _n(n.getIndex()):n.hasLimit()?new zs(n):new wi(n)}function dl(n){let e={};if(n.isDefault())return e;let t;if(n.index_===R?t="$priority":n.index_===dm?t="$value":n.index_===yt?t="$key":(_(n.index_ instanceof $s,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=P(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=P(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+P(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=P(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+P(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function hl(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==R&&(e.i=n.index_.toString()),e}var Gs=class n extends gi{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(_(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=wn("p:rest:"),this.listens_={}}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=dl(e._queryParams);this.restRequest_(s+".json",c,(l,d)=>{let h=d;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(s,h,!1,i),Ve(this.listens_,o)===a){let u;l?l===401?u="permission_denied":u="rest_error:"+l:u="ok",r(u,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=dl(e._queryParams),i=e._path.toString(),r=new j;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+He(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=at(a.responseText)}catch{W("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&W("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Ks=class{constructor(){this.rootNode_=v.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Ti(){return{value:null,children:new Map}}function eu(n,e,t){if(E(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,Ti());let r=n.children.get(i);e=S(e),eu(r,e,t)}}function Ys(n,e,t){n.value!==null?t(e,n.value):pm(n,(i,r)=>{let s=new C(e.toString()+"/"+i);Ys(r,s,t)})}function pm(n,e){n.children.forEach((t,i)=>{e(i,t)})}var Js=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&M(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var fl=10*1e3,_m=30*1e3,mm=5*60*1e3,Qs=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Js(e);let i=fl+(_m-fl)*Math.random();an(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;M(e,(r,s)=>{s>0&&Q(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),an(this.reportStats_.bind(this),Math.floor(Math.random()*2*mm))}};var le=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(le||{});function ko(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ro(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Po(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Xs=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=le.ACK_USER_WRITE,this.source=ko()}operationForChild(e){if(E(this.path)){if(this.affectedTree.value!=null)return _(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new C(e));return new n(T(),t,this.revert)}}else return _(y(this.path)===e,"operationForChild called for unrelated child."),new n(S(this.path),this.affectedTree,this.revert)}};var Ci=class n{constructor(e,t){this.source=e,this.path=t,this.type=le.LISTEN_COMPLETE}operationForChild(e){return E(this.path)?new n(this.source,T()):new n(this.source,S(this.path))}};var bt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=le.OVERWRITE}operationForChild(e){return E(this.path)?new n(this.source,T(),this.snap.getImmediateChild(e)):new n(this.source,S(this.path),this.snap)}};var mn=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=le.MERGE}operationForChild(e){if(E(this.path)){let t=this.children.subtree(new C(e));return t.isEmpty()?null:t.value?new bt(this.source,T(),t.value):new n(this.source,T(),t)}else return _(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,S(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ue=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(E(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Zs=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function gm(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(hm(o.childName,o.snapshotNode))}),on(n,r,"child_removed",e,i,t),on(n,r,"child_added",e,i,t),on(n,r,"child_moved",s,i,t),on(n,r,"child_changed",e,i,t),on(n,r,"value",e,i,t),r}function on(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>ym(n,a,c)),o.forEach(a=>{let c=vm(n,a,s);r.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function vm(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function ym(n,e,t){if(e.childName==null||t.childName==null)throw We("Should only compare child_ events.");let i=new I(e.childName,e.snapshotNode),r=new I(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function Ui(n,e){return{eventCache:n,serverCache:e}}function ln(n,e,t,i){return Ui(new ue(e,t,i),n.serverCache)}function tu(n,e,t,i){return Ui(n.eventCache,new ue(e,t,i))}function bi(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function et(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Es,Im=()=>(Es||(Es=new q(I_)),Es),V=class n{static fromObject(e){let t=new n(null);return M(e,(i,r)=>{t=t.set(new C(i),r)}),t}constructor(e,t=Im()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:T(),value:this.value};if(E(e))return null;{let i=y(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(S(e),t);return s!=null?{path:k(new C(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(E(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(S(e)):new n(null)}}set(e,t){if(E(e))return new n(t,this.children);{let i=y(e),s=(this.children.get(i)||new n(null)).set(S(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(E(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let r=i.remove(S(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(E(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(S(e)):null}}setTree(e,t){if(E(e))return t;{let i=y(e),s=(this.children.get(i)||new n(null)).setTree(S(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(T(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(k(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,T(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(E(e))return null;{let s=y(e),o=this.children.get(s);return o?o.findOnPath_(S(e),k(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,T(),t)}foreachOnPath_(e,t,i){if(E(e))return this;{this.value&&i(t,this.value);let r=y(e),s=this.children.get(r);return s?s.foreachOnPath_(S(e),k(t,r),i):new n(null)}}foreach(e){this.foreach_(T(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(k(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var te=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new V(null))}};function un(n,e,t){if(E(e))return new te(new V(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=U(r,e);return s=s.updateChild(o,t),new te(n.writeTree_.set(r,s))}else{let r=new V(t),s=n.writeTree_.setTree(e,r);return new te(s)}}}function eo(n,e,t){let i=n;return M(t,(r,s)=>{i=un(i,k(e,r),s)}),i}function pl(n,e){if(E(e))return te.empty();{let t=n.writeTree_.setTree(e,new V(null));return new te(t)}}function to(n,e){return nt(n,e)!=null}function nt(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(U(t.path,e)):null}function _l(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(R,(i,r)=>{e.push(new I(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new I(i,r.value))}),e}function Ne(n,e){if(E(e))return n;{let t=nt(n,e);return t!=null?new te(new V(t)):new te(n.writeTree_.subtree(e))}}function no(n){return n.writeTree_.isEmpty()}function St(n,e){return nu(T(),n.writeTree_,e)}function nu(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(_(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=nu(k(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(k(n,".priority"),i)),t}}function Wi(n,e){return ou(e,n)}function Em(n,e,t,i,r){_(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=un(n.visibleWrites,e,t)),n.lastWriteId=i}function wm(n,e,t,i){_(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=eo(n.visibleWrites,e,t),n.lastWriteId=i}function Tm(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function Cm(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);_(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&bm(a,i.path)?r=!1:z(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return Sm(n),!0;if(i.snap)n.visibleWrites=pl(n.visibleWrites,i.path);else{let a=i.children;M(a,c=>{n.visibleWrites=pl(n.visibleWrites,k(i.path,c))})}return!0}else return!1}function bm(n,e){if(n.snap)return z(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&z(k(n.path,t),e))return!0;return!1}function Sm(n){n.visibleWrites=iu(n.allWrites,Am,T()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Am(n){return n.visible}function iu(n,e,t){let i=te.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)z(t,o)?(a=U(t,o),i=un(i,a,s.snap)):z(o,t)&&(a=U(o,t),i=un(i,T(),s.snap.getChild(a)));else if(s.children){if(z(t,o))a=U(t,o),i=eo(i,a,s.children);else if(z(o,t))if(a=U(o,t),E(a))i=eo(i,T(),s.children);else{let c=Ve(s.children,y(a));if(c){let l=c.getChild(S(a));i=un(i,T(),l)}}}else throw We("WriteRecord should have .snap or .children")}}return i}function ru(n,e,t,i,r){if(!i&&!r){let s=nt(n.visibleWrites,e);if(s!=null)return s;{let o=Ne(n.visibleWrites,e);if(no(o))return t;if(t==null&&!to(o,T()))return null;{let a=t||v.EMPTY_NODE;return St(o,a)}}}else{let s=Ne(n.visibleWrites,e);if(!r&&no(s))return t;if(!r&&t==null&&!to(s,T()))return null;{let o=function(l){return(l.visible||r)&&(!i||!~i.indexOf(l.writeId))&&(z(l.path,e)||z(e,l.path))},a=iu(n.allWrites,o,e),c=t||v.EMPTY_NODE;return St(a,c)}}}function km(n,e,t){let i=v.EMPTY_NODE,r=nt(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(R,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Ne(n.visibleWrites,e);return t.forEachChild(R,(o,a)=>{let c=St(Ne(s,new C(o)),a);i=i.updateImmediateChild(o,c)}),_l(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Ne(n.visibleWrites,e);return _l(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Rm(n,e,t,i,r){_(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=k(e,t);if(to(n.visibleWrites,s))return null;{let o=Ne(n.visibleWrites,s);return no(o)?r.getChild(t):St(o,r.getChild(t))}}function Pm(n,e,t,i){let r=k(e,t),s=nt(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Ne(n.visibleWrites,r);return St(o,i.getNode().getImmediateChild(t))}else return null}function Nm(n,e){return nt(n.visibleWrites,e)}function Om(n,e,t,i,r,s,o){let a,c=Ne(n.visibleWrites,e),l=nt(c,T());if(l!=null)a=l;else if(t!=null)a=St(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],h=o.getCompare(),u=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=u.getNext();for(;p&&d.length<r;)h(p,i)!==0&&d.push(p),p=u.getNext();return d}else return[]}function Dm(){return{visibleWrites:te.empty(),allWrites:[],lastWriteId:-1}}function Si(n,e,t,i){return ru(n.writeTree,n.treePath,e,t,i)}function No(n,e){return km(n.writeTree,n.treePath,e)}function ml(n,e,t,i){return Rm(n.writeTree,n.treePath,e,t,i)}function Ai(n,e){return Nm(n.writeTree,k(n.treePath,e))}function Lm(n,e,t,i,r,s){return Om(n.writeTree,n.treePath,e,t,i,r,s)}function Oo(n,e,t){return Pm(n.writeTree,n.treePath,e,t)}function su(n,e){return ou(k(n.treePath,e),n.writeTree)}function ou(n,e){return{treePath:n,writeTree:e}}var io=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;_(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),_(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,pn(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,fn(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Ct(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,pn(i,e.snapshotNode,r.oldSnap));else throw We("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var ro=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},au=new ro,gn=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new ue(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Oo(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:et(this.viewCache_),s=Lm(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function Mm(n){return{filter:n}}function xm(n,e){_(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Fm(n,e,t,i,r){let s=new io,o,a;if(t.type===le.OVERWRITE){let l=t;l.source.fromUser?o=so(n,e,l.path,l.snap,i,r,s):(_(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!E(l.path),o=ki(n,e,l.path,l.snap,i,r,a,s))}else if(t.type===le.MERGE){let l=t;l.source.fromUser?o=Wm(n,e,l.path,l.children,i,r,s):(_(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=oo(n,e,l.path,l.children,i,r,a,s))}else if(t.type===le.ACK_USER_WRITE){let l=t;l.revert?o=Bm(n,e,l.path,i,r,s):o=Vm(n,e,l.path,l.affectedTree,i,r,s)}else if(t.type===le.LISTEN_COMPLETE)o=Hm(n,e,t.path,i,s);else throw We("Unknown operation type: "+t.type);let c=s.getChanges();return Um(e,o,c),{viewCache:o,changes:c}}function Um(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=bi(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(Zl(bi(e)))}}function cu(n,e,t,i,r,s){let o=e.eventCache;if(Ai(i,t)!=null)return e;{let a,c;if(E(t))if(_(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=et(e),d=l instanceof v?l:v.EMPTY_NODE,h=No(i,d);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let l=Si(i,et(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{let l=y(t);if(l===".priority"){_(De(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let h=ml(i,t,d,c);h!=null?a=n.filter.updatePriority(d,h):a=o.getNode()}else{let d=S(t),h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let u=ml(i,t,o.getNode(),c);u!=null?h=o.getNode().getImmediateChild(l).updateChild(d,u):h=o.getNode().getImmediateChild(l)}else h=Oo(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,d,r,s):a=o.getNode()}}return ln(e,a,o.isFullyInitialized()||E(t),n.filter.filtersNodes())}}function ki(n,e,t,i,r,s,o,a){let c=e.serverCache,l,d=o?n.filter:n.filter.getIndexedFilter();if(E(t))l=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){let p=c.getNode().updateChild(t,i);l=d.updateFullNode(c.getNode(),p,null)}else{let p=y(t);if(!c.isCompleteForPath(t)&&De(t)>1)return e;let m=S(t),A=c.getNode().getImmediateChild(p).updateChild(m,i);p===".priority"?l=d.updatePriority(c.getNode(),A):l=d.updateChild(c.getNode(),p,A,m,au,null)}let h=tu(e,l,c.isFullyInitialized()||E(t),d.filtersNodes()),u=new gn(r,h,s);return cu(n,h,t,r,u,a)}function so(n,e,t,i,r,s,o){let a=e.eventCache,c,l,d=new gn(r,e,s);if(E(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=ln(e,l,!0,n.filter.filtersNodes());else{let h=y(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=ln(e,l,a.isFullyInitialized(),a.isFiltered());else{let u=S(t),p=a.getNode().getImmediateChild(h),m;if(E(u))m=i;else{let w=d.getCompleteChild(h);w!=null?Co(u)===".priority"&&w.getChild(Gl(u)).isEmpty()?m=w:m=w.updateChild(u,i):m=v.EMPTY_NODE}if(p.equals(m))c=e;else{let w=n.filter.updateChild(a.getNode(),h,m,u,d,o);c=ln(e,w,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function gl(n,e){return n.eventCache.isCompleteForChild(e)}function Wm(n,e,t,i,r,s,o){let a=e;return i.foreach((c,l)=>{let d=k(t,c);gl(e,y(d))&&(a=so(n,a,d,l,r,s,o))}),i.foreach((c,l)=>{let d=k(t,c);gl(e,y(d))||(a=so(n,a,d,l,r,s,o))}),a}function vl(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function oo(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;E(t)?l=i:l=new V(null).setTree(t,i);let d=e.serverCache.getNode();return l.children.inorderTraversal((h,u)=>{if(d.hasChild(h)){let p=e.serverCache.getNode().getImmediateChild(h),m=vl(n,p,u);c=ki(n,c,new C(h),m,r,s,o,a)}}),l.children.inorderTraversal((h,u)=>{let p=!e.serverCache.isCompleteForChild(h)&&u.value===null;if(!d.hasChild(h)&&!p){let m=e.serverCache.getNode().getImmediateChild(h),w=vl(n,m,u);c=ki(n,c,new C(h),w,r,s,o,a)}}),c}function Vm(n,e,t,i,r,s,o){if(Ai(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(E(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return ki(n,e,t,c.getNode().getChild(t),r,s,a,o);if(E(t)){let l=new V(null);return c.getNode().forEachChild(yt,(d,h)=>{l=l.set(new C(d),h)}),oo(n,e,t,l,r,s,a,o)}else return e}else{let l=new V(null);return i.foreach((d,h)=>{let u=k(t,d);c.isCompleteForPath(u)&&(l=l.set(d,c.getNode().getChild(u)))}),oo(n,e,t,l,r,s,a,o)}}function Hm(n,e,t,i,r){let s=e.serverCache,o=tu(e,s.getNode(),s.isFullyInitialized()||E(t),s.isFiltered());return cu(n,o,t,i,au,r)}function Bm(n,e,t,i,r,s){let o;if(Ai(i,t)!=null)return e;{let a=new gn(i,e,r),c=e.eventCache.getNode(),l;if(E(t)||y(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Si(i,et(e));else{let h=e.serverCache.getNode();_(h instanceof v,"serverChildren would be complete if leaf node"),d=No(i,h)}d=d,l=n.filter.updateFullNode(c,d,s)}else{let d=y(t),h=Oo(i,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?l=n.filter.updateChild(c,d,h,S(t),a,s):e.eventCache.getNode().hasChild(d)?l=n.filter.updateChild(c,d,v.EMPTY_NODE,S(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Si(i,et(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||Ai(i,T())!=null,ln(e,l,o,n.filter.filtersNodes())}}var ao=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new _n(i.getIndex()),s=fm(i);this.processor_=Mm(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(v.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(v.EMPTY_NODE,a.getNode(),null),d=new ue(c,o.isFullyInitialized(),r.filtersNodes()),h=new ue(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Ui(h,d),this.eventGenerator_=new Zs(this.query_)}get query(){return this.query_}};function $m(n){return n.viewCache_.serverCache.getNode()}function jm(n){return bi(n.viewCache_)}function zm(n,e){let t=et(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!E(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function yl(n){return n.eventRegistrations_.length===0}function qm(n,e){n.eventRegistrations_.push(e)}function Il(n,e,t){let i=[];if(t){_(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function El(n,e,t,i){e.type===le.MERGE&&e.source.queryId!==null&&(_(et(n.viewCache_),"We should always have a full cache before handling merges"),_(bi(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=Fm(n.processor_,r,e,t,i);return xm(n.processor_,s.viewCache),_(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,lu(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Gm(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(R,(s,o)=>{i.push(Ct(s,o))}),t.isFullyInitialized()&&i.push(Zl(t.getNode())),lu(n,i,t.getNode(),e)}function lu(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return gm(n.eventGenerator_,e,t,r)}var Ri,Pi=class{constructor(){this.views=new Map}};function Km(n){_(!Ri,"__referenceConstructor has already been defined"),Ri=n}function Ym(){return _(Ri,"Reference.ts has not been loaded"),Ri}function Jm(n){return n.views.size===0}function Do(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return _(s!=null,"SyncTree gave us an op for an invalid query."),El(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(El(o,e,t,i));return s}}function uu(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Si(t,r?i:null),c=!1;a?c=!0:i instanceof v?(a=No(t,i),c=!1):(a=v.EMPTY_NODE,c=!1);let l=Ui(new ue(a,c,!1),new ue(i,r,!1));return new ao(e,l)}return o}function Qm(n,e,t,i,r,s){let o=uu(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),qm(o,t),Gm(o,t)}function Xm(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=Le(n);if(r==="default")for(let[c,l]of n.views.entries())o=o.concat(Il(l,t,i)),yl(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{let c=n.views.get(r);c&&(o=o.concat(Il(c,t,i)),yl(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Le(n)&&s.push(new(Ym())(e._repo,e._path)),{removed:s,events:o}}function du(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Oe(n,e){let t=null;for(let i of n.views.values())t=t||zm(i,e);return t}function hu(n,e){if(e._queryParams.loadsAllData())return Vi(n);{let i=e._queryIdentifier;return n.views.get(i)}}function fu(n,e){return hu(n,e)!=null}function Le(n){return Vi(n)!=null}function Vi(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Ni;function Zm(n){_(!Ni,"__referenceConstructor has already been defined"),Ni=n}function eg(){return _(Ni,"Reference.ts has not been loaded"),Ni}var tg=1,Oi=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new V(null),this.pendingWriteTree_=Dm(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function pu(n,e,t,i,r){return Em(n.pendingWriteTree_,e,t,i,r),r?Pt(n,new bt(ko(),e,t)):[]}function ng(n,e,t,i){wm(n.pendingWriteTree_,e,t,i);let r=V.fromObject(t);return Pt(n,new mn(ko(),e,r))}function Pe(n,e,t=!1){let i=Tm(n.pendingWriteTree_,e);if(Cm(n.pendingWriteTree_,e)){let s=new V(null);return i.snap!=null?s=s.set(T(),!0):M(i.children,o=>{s=s.set(new C(o),!0)}),Pt(n,new Xs(i.path,s,t))}else return[]}function Cn(n,e,t){return Pt(n,new bt(Ro(),e,t))}function ig(n,e,t){let i=V.fromObject(t);return Pt(n,new mn(Ro(),e,i))}function rg(n,e){return Pt(n,new Ci(Ro(),e))}function sg(n,e,t){let i=Mo(n,t);if(i){let r=xo(i),s=r.path,o=r.queryId,a=U(s,e),c=new Ci(Po(o),a);return Fo(n,s,c)}else return[]}function Di(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||fu(o,e))){let c=Xm(o,e,t,i);Jm(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let l=c.removed;if(a=c.events,!r){let d=l.findIndex(u=>u._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(u,p)=>Le(p));if(d&&!h){let u=n.syncPointTree_.subtree(s);if(!u.isEmpty()){let p=cg(u);for(let m=0;m<p.length;++m){let w=p[m],A=w.query,B=vu(n,w);n.listenProvider_.startListening(dn(A),vn(n,A),B.hashFn,B.onComplete)}}}!h&&l.length>0&&!i&&(d?n.listenProvider_.stopListening(dn(e),null):l.forEach(u=>{let p=n.queryToTagMap.get(Hi(u));n.listenProvider_.stopListening(dn(u),p)}))}lg(n,l)}return a}function _u(n,e,t,i){let r=Mo(n,i);if(r!=null){let s=xo(r),o=s.path,a=s.queryId,c=U(o,e),l=new bt(Po(a),c,t);return Fo(n,o,l)}else return[]}function og(n,e,t,i){let r=Mo(n,i);if(r){let s=xo(r),o=s.path,a=s.queryId,c=U(o,e),l=V.fromObject(t),d=new mn(Po(a),c,l);return Fo(n,o,d)}else return[]}function co(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(u,p)=>{let m=U(u,r);s=s||Oe(p,m),o=o||Le(p)});let a=n.syncPointTree_.get(r);a?(o=o||Le(a),s=s||Oe(a,T())):(a=new Pi,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=v.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((p,m)=>{let w=Oe(m,T());w&&(s=s.updateImmediateChild(p,w))}));let l=fu(a,e);if(!l&&!e._queryParams.loadsAllData()){let u=Hi(e);_(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");let p=ug();n.queryToTagMap.set(u,p),n.tagToQueryMap.set(p,u)}let d=Wi(n.pendingWriteTree_,r),h=Qm(a,e,t,d,s,c);if(!l&&!o&&!i){let u=hu(a,e);h=h.concat(dg(n,e,u))}return h}function Lo(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=U(o,e),l=Oe(a,c);if(l)return l});return ru(r,e,s,t,!0)}function ag(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(l,d)=>{let h=U(l,t);i=i||Oe(d,h)});let r=n.syncPointTree_.get(t);r?i=i||Oe(r,T()):(r=new Pi,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new ue(i,!0,!1):null,a=Wi(n.pendingWriteTree_,e._path),c=uu(r,e,a,s?o.getNode():v.EMPTY_NODE,s);return jm(c)}function Pt(n,e){return mu(e,n.syncPointTree_,null,Wi(n.pendingWriteTree_,T()))}function mu(n,e,t,i){if(E(n.path))return gu(n,e,t,i);{let r=e.get(T());t==null&&r!=null&&(t=Oe(r,T()));let s=[],o=y(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let l=t?t.getImmediateChild(o):null,d=su(i,o);s=s.concat(mu(a,c,l,d))}return r&&(s=s.concat(Do(r,n,i,t))),s}}function gu(n,e,t,i){let r=e.get(T());t==null&&r!=null&&(t=Oe(r,T()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,l=su(i,o),d=n.operationForChild(o);d&&(s=s.concat(gu(d,a,c,l)))}),r&&(s=s.concat(Do(r,n,i,t))),s}function vu(n,e){let t=e.query,i=vn(n,t);return{hashFn:()=>($m(e)||v.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?sg(n,t._path,i):rg(n,t._path);{let s=T_(r,t);return Di(n,t,null,s)}}}}function vn(n,e){let t=Hi(e);return n.queryToTagMap.get(t)}function Hi(n){return n._path.toString()+"$"+n._queryIdentifier}function Mo(n,e){return n.tagToQueryMap.get(e)}function xo(n){let e=n.indexOf("$");return _(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new C(n.substr(0,e))}}function Fo(n,e,t){let i=n.syncPointTree_.get(e);_(i,"Missing sync point for query tag that we're tracking");let r=Wi(n.pendingWriteTree_,e);return Do(i,t,r,null)}function cg(n){return n.fold((e,t,i)=>{if(t&&Le(t))return[Vi(t)];{let r=[];return t&&(r=du(t)),M(i,(s,o)=>{r=r.concat(o)}),r}})}function dn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(eg())(n._repo,n._path):n}function lg(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=Hi(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function ug(){return tg++}function dg(n,e,t){let i=e._path,r=vn(n,e),s=vu(n,t),o=n.listenProvider_.startListening(dn(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)_(!Le(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((l,d,h)=>{if(!E(l)&&d&&Le(d))return[Vi(d).query];{let u=[];return d&&(u=u.concat(du(d).map(p=>p.query))),M(h,(p,m)=>{u=u.concat(m)}),u}});for(let l=0;l<c.length;++l){let d=c[l];n.listenProvider_.stopListening(dn(d),vn(n,d))}}return o}var lo=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},uo=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=k(this.path_,e);return new n(this.syncTree_,t)}node(){return Lo(this.syncTree_,this.path_)}},hg=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},wl=function(n,e,t){if(!n||typeof n!="object")return n;if(_(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return fg(n[".sv"],e,t);if(typeof n[".sv"]=="object")return pg(n[".sv"],e);_(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},fg=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:_(!1,"Unexpected server value: "+n)}},pg=function(n,e,t){n.hasOwnProperty("increment")||_(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&_(!1,"Unexpected increment value: "+i);let r=e.node();if(_(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},yu=function(n,e,t,i){return Uo(e,new uo(t,n),i)},Iu=function(n,e,t){return Uo(n,new lo(e),t)};function Uo(n,e,t){let i=n.getPriority().val(),r=wl(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=wl(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new wt(a,D(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new wt(r))),o.forEachChild(R,(a,c)=>{let l=Uo(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}var yn=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Wo(n,e){let t=e instanceof C?e:new C(e),i=n,r=y(t);for(;r!==null;){let s=Ve(i.node.children,r)||{children:{},childCount:0};i=new yn(r,i,s),t=S(t),r=y(t)}return i}function Nt(n){return n.node.value}function Eu(n,e){n.node.value=e,ho(n)}function wu(n){return n.node.childCount>0}function _g(n){return Nt(n)===void 0&&!wu(n)}function Bi(n,e){M(n.node.children,(t,i)=>{e(new yn(t,n,i))})}function Tu(n,e,t,i){t&&!i&&e(n),Bi(n,r=>{Tu(r,e,!0,i)}),t&&i&&e(n)}function mg(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function bn(n){return new C(n.parent===null?n.name:bn(n.parent)+"/"+n.name)}function ho(n){n.parent!==null&&gg(n.parent,n.name,n)}function gg(n,e,t){let i=_g(t),r=Q(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,ho(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,ho(n))}var vg=/[\[\].#$\/\u0000-\u001F\u007F]/,yg=/[\[\].#$\u0000-\u001F\u007F]/,ws=10*1024*1024,Vo=function(n){return typeof n=="string"&&n.length!==0&&!vg.test(n)},Cu=function(n){return typeof n=="string"&&n.length!==0&&!yg.test(n)},Ig=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Cu(n)},Eg=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Eo(n)||n&&typeof n=="object"&&Q(n,".sv")},bu=function(n,e,t,i){i&&e===void 0||$i(Ut(n,"value"),e,t)},$i=function(n,e,t){let i=t instanceof C?new xs(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Je(i));if(typeof e=="function")throw new Error(n+"contains a function "+Je(i)+" with contents = "+e.toString());if(Eo(e))throw new Error(n+"contains "+e.toString()+" "+Je(i));if(typeof e=="string"&&e.length>ws/3&&Wt(e)>ws)throw new Error(n+"contains a string greater than "+ws+" utf8 bytes "+Je(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(M(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Vo(o)))throw new Error(n+" contains an invalid key ("+o+") "+Je(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Z_(i,o),$i(n,a,i),em(i)}),r&&s)throw new Error(n+' contains ".value" child '+Je(i)+" in addition to actual children.")}},wg=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=hn(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Vo(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(X_);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&z(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},Tg=function(n,e,t,i){if(i&&e===void 0)return;let r=Ut(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];M(e,(o,a)=>{let c=new C(o);if($i(r,a,k(t,c)),Co(c)===".priority"&&!Eg(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),wg(r,s)};var Su=function(n,e,t,i){if(!(i&&t===void 0)&&!Cu(t))throw new Error(Ut(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Cg=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Su(n,e,t,i)},Ho=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},bg=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Vo(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Ig(t))throw new Error(Ut(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var fo=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ji(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!bo(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function Au(n,e,t){ji(n,t),ku(n,i=>bo(i,e))}function G(n,e,t){ji(n,t),ku(n,i=>z(i,e)||z(e,i))}function ku(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(Sg(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Sg(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();Xe&&L("event: "+t.toString()),Rt(i)}}}var Ag="repo_interrupt",kg=25,po=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ti(),this.transactionQueueTree_=new yn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Rg(n,e,t){if(n.stats_=To(n.repoInfo_),n.forceRestClient_||A_())n.server_=new Gs(n.repoInfo_,(i,r,s,o)=>{Tl(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Cl(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new So(n.repoInfo_,e,(i,r,s,o)=>{Tl(n,i,r,s,o)},i=>{Cl(n,i)},i=>{Pg(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=R_(n.repoInfo_,()=>new Qs(n.stats_,n.server_)),n.infoData_=new Ks,n.infoSyncTree_=new Oi({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Cn(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Bo(n,"connected",!1),n.serverSyncTree_=new Oi({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let l=o(a,c);G(n.eventQueue_,i._path,l)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function Ru(n){let t=n.infoData_.getNode(new C(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function zi(n){return hg({timestamp:Ru(n)})}function Tl(n,e,t,i,r){n.dataUpdateCount++;let s=new C(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=Ft(t,l=>D(l));o=og(n.serverSyncTree_,s,c,r)}else{let c=D(t);o=_u(n.serverSyncTree_,s,c,r)}else if(i){let c=Ft(t,l=>D(l));o=ig(n.serverSyncTree_,s,c)}else{let c=D(t);o=Cn(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=At(n,s)),G(n.eventQueue_,a,o)}function Cl(n,e){Bo(n,"connected",e),e===!1&&Lg(n)}function Pg(n,e){M(e,(t,i)=>{Bo(n,t,i)})}function Bo(n,e,t){let i=new C("/.info/"+e),r=D(t);n.infoData_.updateSnapshot(i,r);let s=Cn(n.infoSyncTree_,i,r);G(n.eventQueue_,i,s)}function $o(n){return n.nextWriteId_++}function Ng(n,e,t){let i=ag(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=D(r).withIndex(e._queryParams.getIndex());co(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Cn(n.serverSyncTree_,e._path,s);else{let a=vn(n.serverSyncTree_,e);o=_u(n.serverSyncTree_,e._path,s,a)}return G(n.eventQueue_,e._path,o),Di(n.serverSyncTree_,e,t,null,!0),s},r=>(Sn(n,"get for query "+P(e)+" failed: "+r),Promise.reject(new Error(r))))}function Og(n,e,t,i,r){Sn(n,"set",{path:e.toString(),value:t,priority:i});let s=zi(n),o=D(t,i),a=Lo(n.serverSyncTree_,e),c=Iu(o,a,s),l=$o(n),d=pu(n.serverSyncTree_,e,c,l,!0);ji(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(u,p)=>{let m=u==="ok";m||W("set at "+e+" failed: "+u);let w=Pe(n.serverSyncTree_,l,!m);G(n.eventQueue_,e,w),_o(n,r,u,p)});let h=zo(n,e);At(n,h),G(n.eventQueue_,h,[])}function Dg(n,e,t,i){Sn(n,"update",{path:e.toString(),value:t});let r=!0,s=zi(n),o={};if(M(t,(a,c)=>{r=!1,o[a]=yu(k(e,a),D(c),n.serverSyncTree_,s)}),r)L("update() called with empty data.  Don't do anything."),_o(n,i,"ok",void 0);else{let a=$o(n),c=ng(n.serverSyncTree_,e,o,a);ji(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,d)=>{let h=l==="ok";h||W("update at "+e+" failed: "+l);let u=Pe(n.serverSyncTree_,a,!h),p=u.length>0?At(n,e):e;G(n.eventQueue_,p,u),_o(n,i,l,d)}),M(t,l=>{let d=zo(n,k(e,l));At(n,d)}),G(n.eventQueue_,e,[])}}function Lg(n){Sn(n,"onDisconnectEvents");let e=zi(n),t=Ti();Ys(n.onDisconnect_,T(),(r,s)=>{let o=yu(r,s,n.serverSyncTree_,e);eu(t,r,o)});let i=[];Ys(t,T(),(r,s)=>{i=i.concat(Cn(n.serverSyncTree_,r,s));let o=zo(n,r);At(n,o)}),n.onDisconnect_=Ti(),G(n.eventQueue_,T(),i)}function Mg(n,e,t){let i;y(e._path)===".info"?i=co(n.infoSyncTree_,e,t):i=co(n.serverSyncTree_,e,t),Au(n.eventQueue_,e._path,i)}function bl(n,e,t){let i;y(e._path)===".info"?i=Di(n.infoSyncTree_,e,t):i=Di(n.serverSyncTree_,e,t),Au(n.eventQueue_,e._path,i)}function xg(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Ag)}function Sn(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),L(t,...e)}function _o(n,e,t,i){e&&Rt(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function Pu(n,e,t){return Lo(n.serverSyncTree_,e,t)||v.EMPTY_NODE}function jo(n,e=n.transactionQueueTree_){if(e||qi(n,e),Nt(e)){let t=Ou(n,e);_(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&Fg(n,bn(e),t)}else wu(e)&&Bi(e,t=>{jo(n,t)})}function Fg(n,e,t){let i=t.map(l=>l.currentWriteId),r=Pu(n,e,i),s=r,o=r.hash();for(let l=0;l<t.length;l++){let d=t[l];_(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let h=U(e,d.path);s=s.updateChild(h,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{Sn(n,"transaction put response",{path:c.toString(),status:l});let d=[];if(l==="ok"){let h=[];for(let u=0;u<t.length;u++)t[u].status=2,d=d.concat(Pe(n.serverSyncTree_,t[u].currentWriteId)),t[u].onComplete&&h.push(()=>t[u].onComplete(null,!0,t[u].currentOutputSnapshotResolved)),t[u].unwatcher();qi(n,Wo(n.transactionQueueTree_,e)),jo(n,n.transactionQueueTree_),G(n.eventQueue_,e,d);for(let u=0;u<h.length;u++)Rt(h[u])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{W("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}At(n,e)}},o)}function At(n,e){let t=Nu(n,e),i=bn(t),r=Ou(n,t);return Ug(n,r,i),i}function Ug(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=U(t,c.path),d=!1,h;if(_(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,r=r.concat(Pe(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=kg)d=!0,h="maxretry",r=r.concat(Pe(n.serverSyncTree_,c.currentWriteId,!0));else{let u=Pu(n,c.path,o);c.currentInputSnapshot=u;let p=e[a].update(u.val());if(p!==void 0){$i("transaction failed: Data returned ",p,c.path);let m=D(p);typeof p=="object"&&p!=null&&Q(p,".priority")||(m=m.updatePriority(u.getPriority()));let A=c.currentWriteId,B=zi(n),$=Iu(m,u,B);c.currentOutputSnapshotRaw=m,c.currentOutputSnapshotResolved=$,c.currentWriteId=$o(n),o.splice(o.indexOf(A),1),r=r.concat(pu(n.serverSyncTree_,c.path,$,c.currentWriteId,c.applyLocally)),r=r.concat(Pe(n.serverSyncTree_,A,!0))}else d=!0,h="nodata",r=r.concat(Pe(n.serverSyncTree_,c.currentWriteId,!0))}G(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(u){setTimeout(u,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}qi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Rt(i[a]);jo(n,n.transactionQueueTree_)}function Nu(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&Nt(i)===void 0;)i=Wo(i,t),e=S(e),t=y(e);return i}function Ou(n,e){let t=[];return Du(n,e,t),t.sort((i,r)=>i.order-r.order),t}function Du(n,e,t){let i=Nt(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Bi(e,r=>{Du(n,r,t)})}function qi(n,e){let t=Nt(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,Eu(e,t.length>0?t:void 0)}Bi(e,i=>{qi(n,i)})}function zo(n,e){let t=bn(Nu(n,e)),i=Wo(n.transactionQueueTree_,e);return mg(i,r=>{Ts(n,r)}),Ts(n,i),Tu(i,r=>{Ts(n,r)}),t}function Ts(n,e){let t=Nt(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(_(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(_(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Pe(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Eu(e,void 0):t.length=s+1,G(n.eventQueue_,bn(e),r);for(let o=0;o<i.length;o++)Rt(i[o])}}function Wg(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function Vg(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):W(`Invalid query segment '${t}' in query '${n}'`)}return e}var Sl=function(n,e){let t=Hg(n),i=t.namespace;t.domain==="firebase.com"&&ye(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&ye("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||v_();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new _i(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new C(t.pathString)}},Hg=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let d=n.indexOf("/");d===-1&&(d=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(d,h)),d<h&&(r=Wg(n.substring(d,h)));let u=Vg(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let p=e.slice(0,l);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),t=e.substring(m+1),s=i}"ns"in u&&(s=u.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var Al="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Bg=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=Al.charAt(t%64),t=Math.floor(t/64);_(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=Al.charAt(e[r]);return _(o.length===20,"nextPushId: Length should be 20."),o}}();var Li=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}},Mi=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var xi=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return _(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var mo=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return E(this._path)?null:Co(this._path)}get ref(){return new de(this._repo,this._path)}get _queryIdentifier(){let e=hl(this._queryParams),t=wo(e);return t==="{}"?"default":t}get _queryObject(){return hl(this._queryParams)}isEqual(e){if(e=O(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=bo(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Q_(this._path)}};var de=class n extends mo{constructor(e,t){super(e,t,new qs,!1)}get parent(){let e=Gl(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},In=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new C(e),i=kt(this.ref,e);return new n(this._node.getChild(t),i,R)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,kt(this.ref,i),R)))}hasChild(e){let t=new C(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Me(n,e){return n=O(n),n._checkNotDeleted("ref"),e!==void 0?kt(n._root,e):n._root}function kt(n,e){return n=O(n),y(n._path)===null?Cg("child","path",e,!1):Su("child","path",e,!1),new de(n._repo,k(n._path,e))}function Lu(n,e){n=O(n),Ho("push",n._path),bu("push",e,n._path,!0);let t=Ru(n._repo),i=Bg(t),r=kt(n,i),s=kt(n,i),o;return e!=null?o=An(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function qo(n){return Ho("remove",n._path),An(n,null)}function An(n,e){n=O(n),Ho("set",n._path),bu("set",e,n._path,!1);let t=new j;return Og(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Mu(n,e){Tg("update",e,n._path,!1);let t=new j;return Dg(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function xu(n){n=O(n);let e=new xi(()=>{}),t=new Fi(e);return Ng(n._repo,n,t).then(i=>new In(i,new de(n._repo,n._path),n._queryParams.getIndex()))}var Fi=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Li("value",this,new In(e.snapshotNode,new de(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Mi(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},go=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Mi(this,e,t):null}createEvent(e,t){_(e.childName!=null,"Child events should have a childName.");let i=kt(new de(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Li(e.type,this,new In(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function $g(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,l=(d,h)=>{bl(n._repo,n,a),c(d,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new xi(t,s||void 0),a=e==="value"?new Fi(o):new go(e,o);return Mg(n._repo,n,a),()=>bl(n._repo,n,a)}function Go(n,e,t,i){return $g(n,"value",e,t,i)}Km(de);Zm(de);var jg="FIREBASE_DATABASE_EMULATOR_HOST",vo={},zg=!1;function qg(n,e,t,i){let r=e.lastIndexOf(":"),s=e.substring(0,r),o=Ee(s);n.repoInfo_=new _i(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function Gg(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||ye("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),L("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Sl(s,r),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[jg]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=Sl(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let d=r&&c?new cn(cn.OWNER):new Rs(n.name,n.options,e);bg("Invalid Firebase Database URL",o),E(o.path)||ye("Database URL must point to the root of a Firebase Database (not including a child path).");let h=Yg(a,n,d,new ks(n,t));return new yo(h,n)}function Kg(n,e){let t=vo[e];(!t||t[n.key]!==n)&&ye(`Database ${e}(${n.repoInfo_}) has already been deleted.`),xg(n),delete t[n.key]}function Yg(n,e,t,i){let r=vo[e.name];r||(r={},vo[e.name]=r);let s=r[n.toURLString()];return s&&ye("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new po(n,zg,t,i),r[n.toURLString()]=s,s}var yo=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Rg(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new de(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Kg(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ye("Cannot call "+e+" on a deleted database.")}};function Fu(n=$e(),e){let t=dt(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let i=la("database");i&&Jg(t,...i)}return t}function Jg(n,e,t,i={}){n=O(n),n._checkNotDeleted("useEmulator");let r=`${e}:${t}`,s=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&re(i,s.repoInfo_.emulatorOptions))return;ye("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ye('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new cn(cn.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:ua(i.mockUserToken,n.app.options.projectId);o=new cn(a)}Ee(e)&&(Mn(e),xn("Database",!0)),qg(s,r,i,o)}function Qg(n){__(Te),X(new F("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Gg(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),N(Yc,Jc,n),N(Yc,Jc,"esm2017")}So.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};So.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Qg();var Uu=class n{constructor(e){this.app=e;this.db=Fu(this.app)}db;userId=null;getCart(e){if(!e)return kn([]);let t=Me(this.db,`carts/${e}/items`);return new ne(i=>{Go(t,r=>{let s=[];r.forEach(o=>{let a=o.val();s.push(xe({id:o.key||""},a))}),i.next(s)},r=>{i.error(r)})})}addItemToCart(e,t,i){return f(this,null,function*(){if(!e)throw new Error("No hay usuario logueado para agregar al carrito.");let r=Me(this.db,`carts/${e}/items/${t.id}`),s=yield xu(r),o,a;if(s.exists()){let c=s.val();o=c.cantidad+i,a=Ot(xe({},c),{cantidad:o})}else o=i,a={id:t.id,nombre:t.nombre,precio:t.precio,cantidad:o,imagenUrl:t.imagenUrl,descripcion:t.descripcion,tipo:t.tipo};return yield An(r,a),o})}updateItemQuantity(e,t,i){return f(this,null,function*(){if(!e)throw new Error("No hay usuario logueado para actualizar el carrito.");if(i<=0){yield this.removeItemFromCart(e,t);return}let r=Me(this.db,`carts/${e}/items/${t}`);yield Mu(r,{cantidad:i})})}removeItemFromCart(e,t){return f(this,null,function*(){if(!e)throw new Error("No hay usuario logueado para modificar el carrito.");let i=Me(this.db,`carts/${e}/items/${t}`);yield qo(i)})}clearCart(e){return f(this,null,function*(){if(!e)throw new Error("No hay usuario logueado para vaciar el carrito.");let t=Me(this.db,`carts/${e}/items`);yield qo(t)})}recordPurchase(e,t,i){return f(this,null,function*(){if(!e)throw new Error("No hay usuario logueado para registrar la compra.");let r=Me(this.db,`purchases/${e}`),s=Lu(r),o={purchaseId:s.key||"",userId:e,items:t,total:i,timestamp:new Date().toISOString()};return yield An(s,o),o})}getPurchaseHistory(e){if(!e)return kn([]);let t=Me(this.db,`purchases/${e}`);return new ne(i=>{Go(t,r=>{let s=[];r.forEach(o=>{let a=o.val();s.push(xe({purchaseId:o.key||""},a))}),i.next(s)},r=>{i.error(r)})})}static \u0275fac=function(t){return new(t||n)(Pn(_e))};static \u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"})};export{N as a,ft as b,wr as c,$n as d,pt as e,pe as f,_e as g,$t as h,Xv as i,Zv as j,zn as k,_s as l,TI as m,CI as n,Kc as o,Me as p,Lu as q,xu as r,Go as s,Fu as t,Uu as u};

"use strict";(self.webpackChunkpiedraviva_app=self.webpackChunkpiedraviva_app||[]).push([[107],{8107:(F,l,i)=>{i.r(l),i.d(l,{PurchaseHistoryComponent:()=>O});var a=i(2200),d=i(8132),s=i(7673),p=i(5558),m=i(6354),t=i(3664),u=i(4796),h=i(6868);const g=(o,n)=>n.purchaseId,_=(o,n)=>n.id;function f(o,n){1&o&&(t.j41(0,"div",7)(1,"p"),t.EFF(2,"Cargando tu historial de compras..."),t.k0s()())}function C(o,n){if(1&o&&(t.j41(0,"div",16),t.nrm(1,"img",19),t.j41(2,"div",20)(3,"span",21),t.EFF(4),t.k0s(),t.j41(5,"span",22),t.EFF(6),t.k0s(),t.j41(7,"span",23),t.EFF(8),t.nI1(9,"currency"),t.k0s()()()),2&o){const e=n.$implicit;t.R7$(),t.Y8G("src",e.imagenUrl||"https://placehold.co/50x50/FF5733/FFFFFF?text=Producto",t.B4B)("alt",e.nombre),t.R7$(3),t.JRh(e.nombre),t.R7$(2),t.SpI("x",e.cantidad),t.R7$(2),t.JRh(t.ii3(9,5,e.precio*e.cantidad,"UYU","$","1.2-2"))}}function x(o,n){if(1&o&&(t.j41(0,"div",11)(1,"div",12)(2,"span",13),t.EFF(3),t.k0s(),t.j41(4,"span",14),t.EFF(5),t.nI1(6,"date"),t.k0s()(),t.j41(7,"div",15),t.Z7z(8,C,10,10,"div",16,_),t.k0s(),t.j41(10,"div",17)(11,"span"),t.EFF(12,"Total de la Compra:"),t.k0s(),t.j41(13,"span",18),t.EFF(14),t.nI1(15,"currency"),t.k0s()()()),2&o){const e=n.$implicit;t.R7$(3),t.SpI("Compra ID: ",e.purchaseId.substring(0,8),"..."),t.R7$(2),t.JRh(t.i5U(6,3,e.timestamp,"short")),t.R7$(3),t.Dyx(e.items),t.R7$(6),t.JRh(t.ii3(15,6,e.total,"UYU","$","1.2-2"))}}function b(o,n){if(1&o&&(t.j41(0,"div",9),t.Z7z(1,x,16,11,"div",11,g),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Dyx(e)}}function P(o,n){1&o&&(t.j41(0,"div",10)(1,"p"),t.EFF(2,"No tienes compras registradas a\xfan."),t.k0s(),t.j41(3,"a",24),t.EFF(4,"Explorar Men\xfa"),t.k0s()())}function v(o,n){1&o&&t.nVh(0,b,3,0,"div",9)(1,P,5,0,"div",10),2&o&&t.vxM(n.length>0?0:1)}function y(o,n){1&o&&(t.j41(0,"div",8)(1,"p"),t.EFF(2,"Ocurri\xf3 un error al cargar el historial de compras."),t.k0s()())}function M(o,n){if(1&o&&(t.nVh(0,v,2,1),t.nI1(1,"async"),t.vZN(2,y,3,0,"div",8)),2&o){let e;const r=t.XpG();t.vxM((e=t.bMT(1,1,r.purchases$))?0:2,e)}}let O=(()=>{class o{authService;cartService;purchases$;currentUserSubscription;userId=null;loading=!0;constructor(e,r){this.authService=e,this.cartService=r,this.purchases$=(0,s.of)([])}ngOnInit(){this.currentUserSubscription=this.authService.user$.pipe((0,p.n)(e=>(this.userId=e?e.uid:null,this.userId?(this.loading=!0,this.cartService.getPurchaseHistory(this.userId)):(this.loading=!1,(0,s.of)([])))),(0,m.T)(e=>(this.loading=!1,console.log("Historial de compras cargado:",e),e.sort((r,c)=>new Date(c.timestamp).getTime()-new Date(r.timestamp).getTime())))).subscribe(e=>this.purchases$=(0,s.of)(e),e=>{console.error("Error al cargar el historial de compras:",e),this.loading=!1,this.purchases$=(0,s.of)([])})}ngOnDestroy(){this.currentUserSubscription&&this.currentUserSubscription.unsubscribe()}static \u0275fac=function(r){return new(r||o)(t.rXU(u.u),t.rXU(h.m))};static \u0275cmp=t.VBU({type:o,selectors:[["app-purchase-history"]],decls:11,vars:1,consts:[[1,"history-main-container"],[1,"history-content-wrapper"],[1,"back-button-container"],["routerLink","/cart",1,"back-button"],[1,"company-logo-container"],["src","https://placehold.co/150x50/FFDDC1/000000?text=Tu+Logo","alt","Logo de la Empresa",1,"company-logo"],[1,"history-title"],[1,"loading-message-history"],[1,"error-loading-history"],[1,"purchases-grid"],[1,"empty-history-message"],[1,"purchase-card"],[1,"purchase-header"],[1,"purchase-id"],[1,"purchase-date"],[1,"purchase-items-list"],[1,"purchase-item"],[1,"purchase-total"],[1,"total-amount"],[1,"purchase-item-image",3,"src","alt"],[1,"purchase-item-details"],[1,"purchase-item-name"],[1,"purchase-item-quantity"],[1,"purchase-item-price"],["routerLink","/",1,"back-to-menu-button"]],template:function(r,c){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),t.EFF(4,"\u2190 Volver al Carrito"),t.k0s()(),t.j41(5,"div",4),t.nrm(6,"img",5),t.k0s(),t.j41(7,"h1",6),t.EFF(8,"Historial de Compras"),t.k0s(),t.nVh(9,f,3,0,"div",7)(10,M,3,3),t.k0s()()),2&r&&(t.R7$(9),t.vxM(c.loading?9:10))},dependencies:[a.MD,d.Wk,a.Jj,a.oe,a.vh],styles:[".history-main-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a202c;color:#e2e8f0;padding:2rem;font-family:sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;flex-direction:column;align-items:center}.history-content-wrapper[_ngcontent-%COMP%]{max-width:800px;width:100%;margin:0 auto;background-color:#2d3748;border-radius:.5rem;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;overflow:hidden;padding:2rem;position:relative}.back-button-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}.back-button[_ngcontent-%COMP%]{display:inline-block;background-color:#4a5568;color:#e2e8f0;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;transition:background-color .3s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#64748b}.history-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;text-align:center;margin-bottom:2rem;color:#f6e05e;font-family:Pacifico,cursive;text-shadow:2px 2px 4px rgba(0,0,0,.5)}.loading-message-history[_ngcontent-%COMP%], .empty-history-message[_ngcontent-%COMP%], .error-loading-history[_ngcontent-%COMP%]{text-align:center;padding:3rem;font-size:1.25rem;color:#a0aec0}.back-to-menu-button[_ngcontent-%COMP%]{display:inline-block;margin-top:1.5rem;background-color:#c53030;color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;transition:background-color .3s ease}.back-to-menu-button[_ngcontent-%COMP%]:hover{background-color:#a02020}.purchases-grid[_ngcontent-%COMP%]{display:grid;gap:2rem}.purchase-card[_ngcontent-%COMP%]{background-color:#1a202c;border-radius:.5rem;box-shadow:0 5px 15px #0003;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.purchase-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #4a5568;padding-bottom:.75rem;margin-bottom:.75rem}.purchase-id[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#a0aec0}.purchase-date[_ngcontent-%COMP%]{font-size:.9rem;color:#a0aec0}.purchase-items-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.purchase-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;background-color:#2d3748;padding:.75rem;border-radius:.375rem;box-shadow:inset 0 1px 3px #0000001a}.purchase-item-image[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:.25rem;object-fit:cover;flex-shrink:0}.purchase-item-details[_ngcontent-%COMP%]{display:flex;flex-grow:1;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.purchase-item-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#fff;flex-basis:100%}@media (min-width: 640px){.purchase-item-name[_ngcontent-%COMP%]{flex-basis:auto}}.purchase-item-quantity[_ngcontent-%COMP%]{font-size:.875rem;color:#a0aec0;margin-left:auto}.purchase-item-price[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#f6e05e;margin-left:.5rem}.purchase-total[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-top:1px solid #4a5568;padding-top:1rem;margin-top:1rem;font-size:1.25rem;font-weight:700;color:#fff}.purchase-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{color:#f6e05e;font-size:1.5rem}"]})}return o})()}}]);